<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="1.新建项目1.1配置JDK在pom.xml文件中修改 1234567&amp;lt;properties&amp;gt;    &amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;    &amp;lt;!--&amp;lt;maven.compiler.source&amp;gt;1.7&amp;lt;/maven.compiler.so">
<meta name="keywords" content="后端">
<meta property="og:type" content="article">
<meta property="og:title" content="课程项目">
<meta property="og:url" content="https://vxiaoxin.github.io/2019/05/08/课程项目/index.html">
<meta property="og:site_name" content="鱼非道-技术博客">
<meta property="og:description" content="1.新建项目1.1配置JDK在pom.xml文件中修改 1234567&amp;lt;properties&amp;gt;    &amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;    &amp;lt;!--&amp;lt;maven.compiler.source&amp;gt;1.7&amp;lt;/maven.compiler.so">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556965950085.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556966643066.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556966727514.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556977427413.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556978507690.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556980440910.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1557026670490.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1557027113000.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1557028061217.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/MyLogo.png">
<meta property="og:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/lanerge.jpg">
<meta property="og:updated_time" content="2019-05-08T13:58:44.528Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="课程项目">
<meta name="twitter:description" content="1.新建项目1.1配置JDK在pom.xml文件中修改 1234567&amp;lt;properties&amp;gt;    &amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;    &amp;lt;!--&amp;lt;maven.compiler.source&amp;gt;1.7&amp;lt;/maven.compiler.so">
<meta name="twitter:image" content="https://vxiaoxin.github.io/2019/05/08/课程项目/F:/学习文件/Typora文档/SchoolProject/1556965950085.png">






  <link rel="canonical" href="https://vxiaoxin.github.io/2019/05/08/课程项目/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>课程项目 | 鱼非道-技术博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/VXiaoXin" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">鱼非道-技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">孤客一身千里外,不知归日是何年.</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>目录</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://vxiaoxin.github.io/2019/05/08/课程项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fidel Yiu">
      <meta itemprop="description" content="大悲大喜过后,我还曾渴望过什么呢?<br/>看着夕阳傻笑,看着霓虹灯落寞.<br/>可我还有梦想呀,你一定要加油.<br/>一直努力!">
      <meta itemprop="image" content="/images/feidao-logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鱼非道-技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">课程项目

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-05-08 16:56:08 / 修改时间：21:58:44" itemprop="dateCreated datePublished" datetime="2019-05-08T16:56:08+08:00">2019-05-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/后端/" itemprop="url" rel="index"><span itemprop="name">后端</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <a href="/2019/05/08/课程项目/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/05/08/课程项目/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1.新建项目"></a>1.新建项目</h1><h2 id="1-1配置JDK"><a href="#1-1配置JDK" class="headerlink" title="1.1配置JDK"></a>1.1配置JDK</h2><p>在<code>pom.xml</code>文件中修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="1-2添加Tomcat"><a href="#1-2添加Tomcat" class="headerlink" title="1.2添加Tomcat"></a>1.2添加Tomcat</h2><h2 id="1-3修改渲染模板"><a href="#1-3修改渲染模板" class="headerlink" title="1.3修改渲染模板"></a>1.3修改渲染模板</h2><p><a href="https://blog.csdn.net/qq_30938705/article/details/79268246" target="_blank" rel="noopener">参考博客</a></p>
<ol>
<li><p>先将原来的<code>web.xml</code>文件删除</p>
</li>
<li><p>在添加时选择3.1版本</p>
<p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1556965950085.png" alt="1556965950085"></p>
</li>
<li><p>修改<code>web.xml</code>，重新添加一个</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="1-4配置默认启动路径"><a href="#1-4配置默认启动路径" class="headerlink" title="1.4配置默认启动路径"></a>1.4配置默认启动路径</h2><p>修改<code>web.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样项目访问<code>&lt;http://localhost:8080/&gt;</code>后就会优先访问<code>index.jsp</code>之后访问<code>index.html</code></p>
<p>两个都不存在就会报错<code>404</code></p>
<h2 id="1-5运行项目"><a href="#1-5运行项目" class="headerlink" title="1.5运行项目"></a>1.5运行项目</h2><ol>
<li>访问<code>&lt;http://localhost:8080/&gt;</code></li>
<li>访问<code>&lt;http://localhost:8080/index.jsp&gt;</code></li>
</ol>
<h1 id="2-实体类设计"><a href="#2-实体类设计" class="headerlink" title="2.实体类设计"></a>2.实体类设计</h1><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1556966643066.png" alt="1556966643066"></p>
<h2 id="2-1区域实体类"><a href="#2-1区域实体类" class="headerlink" title="2.1区域实体类"></a>2.1区域实体类</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1556966727514.png" alt="1556966727514"></p>
<h3 id="2-1-1实体类"><a href="#2-1-1实体类" class="headerlink" title="2.1.1实体类"></a>2.1.1实体类</h3><p>在<code>java</code>文件夹下创建<code>com.xiaoxin.o2o.entity</code>包</p>
<p>创建<code>Area</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Area</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓ID</span></span><br><span class="line">    <span class="keyword">private</span> Integer areaId;</span><br><span class="line">    <span class="comment">// ↓名称</span></span><br><span class="line">    <span class="keyword">private</span> String areaName;</span><br><span class="line">    <span class="comment">// ↓权重</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// ↓创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// ↓修改时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-1-2数据库"><a href="#2-1-2数据库" class="headerlink" title="2.1.2数据库"></a>2.1.2数据库</h3><p>在<code>Navicat Premium</code>中创建<code>o2o</code>数据库，字符集采用<code>utf8 -- UTF-8 Unicode</code>，排序规则<code>utf8_unicode_ci</code></p>
<p>然后创建</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_area`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_area`</span> (</span><br><span class="line">  <span class="string">`area_id`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`area_name`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`area_id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`UK_AREA`</span> (<span class="string">`area_name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">3</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span>=utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`tb_area`</span> (<span class="string">`area_name`</span>, <span class="string">`create_time`</span>, <span class="string">`last_edit_time`</span>) <span class="keyword">VALUES</span> (<span class="string">'xiaoxin'</span>, <span class="string">'2019-05-04 21:40:57'</span>, <span class="string">'2019-05-04 21:40:59'</span>)</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="string">`tb_area`</span> <span class="keyword">WHERE</span> (<span class="string">`area_id`</span>=<span class="string">'1'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="2-2用户实体类"><a href="#2-2用户实体类" class="headerlink" title="2.2用户实体类"></a>2.2用户实体类</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1556977427413.png" alt="1556977427413"></p>
<h3 id="2-2-1实体类"><a href="#2-2-1实体类" class="headerlink" title="2.2.1实体类"></a>2.2.1实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonInfo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ↓用户ID</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="comment">// ↓用户名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// ↓头像地址</span></span><br><span class="line">    <span class="keyword">private</span> String profileImg;</span><br><span class="line">    <span class="comment">// ↓邮箱</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">// ↓性别</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="comment">// ↓禁用状态</span></span><br><span class="line">    <span class="keyword">private</span> Integer enableStatus;</span><br><span class="line">    <span class="comment">// ↓1.顾客 2.店家 3.超级管理员</span></span><br><span class="line">    <span class="keyword">private</span> Integer userType;</span><br><span class="line">    <span class="comment">// ↓创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// ↓修改时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2数据库"><a href="#2-2-2数据库" class="headerlink" title="2.2.2数据库"></a>2.2.2数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_person_info`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_person_info`</span> (</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`profile_img`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`gender`</span> <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'0:禁止使用，1：可以使用'</span>,</span><br><span class="line">  <span class="string">`user_type`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'1.顾客,2.店家,3.超级管理员'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`user_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span>=utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-3微信-amp-本地账号"><a href="#2-3微信-amp-本地账号" class="headerlink" title="2.3微信&amp;本地账号"></a>2.3微信&amp;本地账号</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1556978507690.png" alt="1556978507690"></p>
<p>这是两个实体类</p>
<h3 id="2-3-1微信实体类"><a href="#2-3-1微信实体类" class="headerlink" title="2.3.1微信实体类"></a>2.3.1微信实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatAuth</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓本身ID</span></span><br><span class="line">    <span class="keyword">private</span> Long wechatAuthId;</span><br><span class="line">    <span class="comment">// ↓微信号和公众号绑定的唯一标识</span></span><br><span class="line">    <span class="keyword">private</span> String openId;</span><br><span class="line">    <span class="comment">// ↓创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// ↓关联用户信息ID</span></span><br><span class="line">    <span class="keyword">private</span> PersonInfo personInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-2本地账号实体类"><a href="#2-3-2本地账号实体类" class="headerlink" title="2.3.2本地账号实体类"></a>2.3.2本地账号实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalAuth</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓本身ID</span></span><br><span class="line">    <span class="keyword">private</span> Long localAuthId;</span><br><span class="line">    <span class="comment">// ↓用户名</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">// ↓密码</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// ↓创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// ↓修改时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line">    <span class="comment">// ↓关联用户信息ID</span></span><br><span class="line">    <span class="keyword">private</span> PersonInfo personInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-3微信号数据库"><a href="#2-3-3微信号数据库" class="headerlink" title="2.3.3微信号数据库"></a>2.3.3微信号数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_wechat_auth`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_wechat_auth`</span> (</span><br><span class="line">	<span class="string">`wechat_auth_id`</span> <span class="built_in">INT</span> (<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">	<span class="string">`user_id`</span> <span class="built_in">INT</span> (<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="string">`open_id`</span> <span class="built_in">VARCHAR</span> (<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span> (<span class="string">`wechat_auth_id`</span>),</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> <span class="string">`fk_wechatauth_profile`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`user_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_person_info`</span> (<span class="string">`user_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb_wechat_auth <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span>(open_id);</span><br></pre></td></tr></table></figure>
<h3 id="2-3-4本地号数据库"><a href="#2-3-4本地号数据库" class="headerlink" title="2.3.4本地号数据库"></a>2.3.4本地号数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_local_auth`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_local_auth`</span> (</span><br><span class="line">	<span class="string">`local_auth_id`</span> <span class="built_in">INT</span> (<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">	<span class="string">`user_id`</span> <span class="built_in">INT</span> (<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="string">`username`</span> <span class="built_in">VARCHAR</span> (<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="string">`password`</span> <span class="built_in">VARCHAR</span> (<span class="number">128</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span> (<span class="string">`local_auth_id`</span>),</span><br><span class="line">	<span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_local_profile`</span> (<span class="string">`username`</span>),</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> <span class="string">`fk_localauth_profile`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`user_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_person_info`</span> (<span class="string">`user_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-4头条实体类"><a href="#2-4头条实体类" class="headerlink" title="2.4头条实体类"></a>2.4头条实体类</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1556980440910.png" alt="1556980440910"></p>
<h3 id="2-4-1头条实体类"><a href="#2-4-1头条实体类" class="headerlink" title="2.4.1头条实体类"></a>2.4.1头条实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadLine</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓头条ID</span></span><br><span class="line">    <span class="keyword">private</span> Long lineId;</span><br><span class="line">    <span class="comment">// ↓头条名称</span></span><br><span class="line">    <span class="keyword">private</span> String lineName;</span><br><span class="line">    <span class="comment">// ↓头条链接</span></span><br><span class="line">    <span class="keyword">private</span> String lineLink;</span><br><span class="line">    <span class="comment">// ↓头条图片</span></span><br><span class="line">    <span class="keyword">private</span> String lineImg;</span><br><span class="line">    <span class="comment">// ↓优先级</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// ↓0.不可用 1.可用</span></span><br><span class="line">    <span class="keyword">private</span> Integer enableStatus;</span><br><span class="line">    <span class="comment">// ↓创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// ↓修改时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-2头条数据库"><a href="#2-4-2头条数据库" class="headerlink" title="2.4.2头条数据库"></a>2.4.2头条数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_head_line`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_head_line`</span> (</span><br><span class="line">  <span class="string">`line_id`</span> <span class="built_in">int</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`line_name`</span> <span class="built_in">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`line_link`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`line_img`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`line_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">16</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-5店铺类别实体类"><a href="#2-5店铺类别实体类" class="headerlink" title="2.5店铺类别实体类"></a>2.5店铺类别实体类</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1557026670490.png" alt="1557026670490"></p>
<h3 id="2-5-1店铺实体类"><a href="#2-5-1店铺实体类" class="headerlink" title="2.5.1店铺实体类"></a>2.5.1店铺实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCategory</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 主键ID</span></span><br><span class="line">    <span class="keyword">private</span> Long shopCategoryId;</span><br><span class="line">    <span class="comment">// 类别名</span></span><br><span class="line">    <span class="keyword">private</span> String shopCategoryName;</span><br><span class="line">    <span class="comment">// 类别描述</span></span><br><span class="line">    <span class="keyword">private</span> String shopCategoryDesc;</span><br><span class="line">    <span class="comment">// 类别图片地址(针对一级类别)</span></span><br><span class="line">    <span class="keyword">private</span> String shopCategoryImg;</span><br><span class="line">    <span class="comment">// 权重，越大越排前显示</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// 最近的更新时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line">    <span class="comment">// 父类别</span></span><br><span class="line">    <span class="keyword">private</span> ShopCategory parent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-2店铺类别数据库"><a href="#2-5-2店铺类别数据库" class="headerlink" title="2.5.2店铺类别数据库"></a>2.5.2店铺类别数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_shop_category`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_shop_category`</span> (</span><br><span class="line">  <span class="string">`shop_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`shop_category_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`shop_category_desc`</span> <span class="built_in">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`shop_category_img`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`parent_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`shop_category_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_category_self`</span> (<span class="string">`parent_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_category_self`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop_category`</span> (<span class="string">`shop_category_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">36</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-6店铺实体类"><a href="#2-6店铺实体类" class="headerlink" title="2.6店铺实体类"></a>2.6店铺实体类</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1557027113000.png" alt="1557027113000"></p>
<h3 id="2-6-1店铺实体类"><a href="#2-6-1店铺实体类" class="headerlink" title="2.6.1店铺实体类"></a>2.6.1店铺实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shop</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 主键ID</span></span><br><span class="line">    <span class="keyword">private</span> Long shopId;</span><br><span class="line">    <span class="comment">// 店铺名称</span></span><br><span class="line">    <span class="keyword">private</span> String shopName;</span><br><span class="line">    <span class="comment">// 店铺简介</span></span><br><span class="line">    <span class="keyword">private</span> String shopDesc;</span><br><span class="line">    <span class="comment">// 店铺地址</span></span><br><span class="line">    <span class="keyword">private</span> String shopAddr;</span><br><span class="line">    <span class="comment">// 店铺号码</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">// 店铺门面图片地址</span></span><br><span class="line">    <span class="keyword">private</span> String shopImg;</span><br><span class="line">    <span class="comment">// 权重，越大越排前显示</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// 最近一次更新的时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line">    <span class="comment">// -1.不可用 0.审核中 1.可用</span></span><br><span class="line">    <span class="keyword">private</span> Integer enableStatus;</span><br><span class="line">    <span class="comment">// 超级管理员给店家的提醒，包括为什么审核不通过等</span></span><br><span class="line">    <span class="keyword">private</span> String advice;</span><br><span class="line">    <span class="comment">// 店铺所属区域</span></span><br><span class="line">    <span class="keyword">private</span> Area area;</span><br><span class="line">    <span class="comment">// 店铺是属于哪个店家的</span></span><br><span class="line">    <span class="keyword">private</span> PersonInfo owner;</span><br><span class="line">    <span class="comment">// 店铺类别</span></span><br><span class="line">    <span class="keyword">private</span> ShopCategory shopCategory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-2店铺数据库"><a href="#2-6-2店铺数据库" class="headerlink" title="2.6.2店铺数据库"></a>2.6.2店铺数据库</h3><p>三个外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_shop`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_shop`</span> (</span><br><span class="line">  <span class="string">`shop_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`owner_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'店铺创建人'</span>,</span><br><span class="line">  <span class="string">`area_id`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_name`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_desc`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_addr`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_img`</span> <span class="built_in">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`advice`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`shop_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_area`</span> (<span class="string">`area_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_profile`</span> (<span class="string">`owner_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_shop_shopcate`</span> (<span class="string">`shop_category_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_area`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`area_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_area`</span> (<span class="string">`area_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_profile`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`owner_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_person_info`</span> (<span class="string">`user_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_shop_shopcate`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`shop_category_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop_category`</span> (<span class="string">`shop_category_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">36</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-7商品类别实体类"><a href="#2-7商品类别实体类" class="headerlink" title="2.7商品类别实体类"></a>2.7商品类别实体类</h2><h3 id="2-7-1实体类"><a href="#2-7-1实体类" class="headerlink" title="2.7.1实体类"></a>2.7.1实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductCategory</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 主键ID</span></span><br><span class="line">    <span class="keyword">private</span> Long productCategoryId;</span><br><span class="line">    <span class="comment">// 该类别是属于哪个店铺的</span></span><br><span class="line">    <span class="keyword">private</span> Long shopId;</span><br><span class="line">    <span class="comment">// 类别名</span></span><br><span class="line">    <span class="keyword">private</span> String productCategoryName;</span><br><span class="line">    <span class="comment">// 权重，越大越排前显示</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-7-2数据库"><a href="#2-7-2数据库" class="headerlink" title="2.7.2数据库"></a>2.7.2数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_product_category`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_product_category`</span> (</span><br><span class="line">  <span class="string">`product_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`product_category_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`product_category_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_procate_shop`</span> (<span class="string">`shop_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_procate_shop`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`shop_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop`</span> (<span class="string">`shop_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">32</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-8商品实体类"><a href="#2-8商品实体类" class="headerlink" title="2.8商品实体类"></a>2.8商品实体类</h2><p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\1557028061217.png" alt="1557028061217"></p>
<h3 id="2-8-1实体类"><a href="#2-8-1实体类" class="headerlink" title="2.8.1实体类"></a>2.8.1实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 主键ID</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    <span class="comment">// 商品名</span></span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line">    <span class="comment">// 商品简介</span></span><br><span class="line">    <span class="keyword">private</span> String productDesc;</span><br><span class="line">    <span class="comment">// 简略图</span></span><br><span class="line">    <span class="keyword">private</span> String imgAddr;</span><br><span class="line">    <span class="comment">// 原价</span></span><br><span class="line">    <span class="keyword">private</span> String normalPrice;</span><br><span class="line">    <span class="comment">// 现价(推广价格)</span></span><br><span class="line">    <span class="keyword">private</span> String promotionPrice;</span><br><span class="line">    <span class="comment">// 权重，越大越排前显示</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// 商品积分</span></span><br><span class="line">    <span class="keyword">private</span> Integer point;</span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// 最近一次的更新时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastEditTime;</span><br><span class="line">    <span class="comment">// 0.下架 1.在前端展示系统展示</span></span><br><span class="line">    <span class="keyword">private</span> Integer enableStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片详情图列表，跟商品是多对一的关系</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ProductImg&gt; productImgList;</span><br><span class="line">    <span class="comment">// 商品类别，一件商品仅属于一个商品类别</span></span><br><span class="line">    <span class="keyword">private</span> ProductCategory productCategory;</span><br><span class="line">    <span class="comment">// 店铺实体类，标明商品属于哪个店铺</span></span><br><span class="line">    <span class="keyword">private</span> Shop shop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-8-2数据库"><a href="#2-8-2数据库" class="headerlink" title="2.8.2数据库"></a>2.8.2数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_product`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_product`</span> (</span><br><span class="line">  <span class="string">`product_id`</span> <span class="built_in">int</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`product_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_desc`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`img_addr`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`normal_price`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`promotion_price`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`last_edit_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`enable_status`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`product_category_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`shop_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`product_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_product_procate`</span> (<span class="string">`product_category_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_product_shop`</span> (<span class="string">`shop_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_product_procate`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`product_category_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_product_category`</span> (<span class="string">`product_category_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_product_shop`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`shop_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_shop`</span> (<span class="string">`shop_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">37</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h2 id="2-9详情图片"><a href="#2-9详情图片" class="headerlink" title="2.9详情图片"></a>2.9详情图片</h2><h3 id="2-9-1实体类"><a href="#2-9-1实体类" class="headerlink" title="2.9.1实体类"></a>2.9.1实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductImg</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 主键ID</span></span><br><span class="line">    <span class="keyword">private</span> Long productImgId;</span><br><span class="line">    <span class="comment">// 图片地址</span></span><br><span class="line">    <span class="keyword">private</span> String imgAddr;</span><br><span class="line">    <span class="comment">// 图片简介</span></span><br><span class="line">    <span class="keyword">private</span> String imgDesc;</span><br><span class="line">    <span class="comment">// 权重，越大越排前显示</span></span><br><span class="line">    <span class="keyword">private</span> Integer priority;</span><br><span class="line">    <span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">// 标明是属于哪个商品的图片</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get &amp; set &amp; toString方法 &amp; 无参构造方法 &amp; 有参构造方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-9-2数据库"><a href="#2-9-2数据库" class="headerlink" title="2.9.2数据库"></a>2.9.2数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`tb_product_img`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tb_product_img`</span> (</span><br><span class="line">  <span class="string">`product_img_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`img_addr`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`img_desc`</span> <span class="built_in">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`priority`</span> <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`product_img_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_proimg_product`</span> (<span class="string">`product_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fk_proimg_product`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`product_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`tb_product`</span> (<span class="string">`product_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">31</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COLLATE</span> = utf8_unicode_ci;</span><br></pre></td></tr></table></figure>
<h1 id="3-配置Maven"><a href="#3-配置Maven" class="headerlink" title="3.配置Maven"></a>3.配置Maven</h1><h2 id="3-1文件概述"><a href="#3-1文件概述" class="headerlink" title="3.1文件概述"></a>3.1文件概述</h2><ul>
<li>src\main\java-&gt;源代码</li>
<li>src\main\java\entity-&gt;实体类</li>
<li>src\main\java\web-&gt;控制层</li>
<li>src\main\java\service-&gt;服务层</li>
<li>src\main\java\service\impl-&gt;服务层接口实现类</li>
<li>src\main\java\dao-&gt;访问数据库层</li>
<li>src\main\java\dto-&gt;entity的再封装</li>
<li>src\main\java\enums-&gt;枚举类</li>
<li>src\main\java\interceptor-&gt;拦截器</li>
<li>src\main\java\util-&gt;工具类</li>
<li>src\resources-&gt;项目用的资源文件，各种spring、mybatis、日志的配置文件</li>
<li>src\resources\spring-&gt;spring相关配置信息</li>
<li>src\resources\mapper-&gt;存放dao中每个实体对应的sql，实现dao接口的逻辑</li>
<li>src\test\java-&gt;单元测试代码</li>
<li>src\test\resources-&gt;单元测试用的配置文件</li>
<li>src\main\webapp-&gt;存放前端的静态资源</li>
<li>src\main\webapp\resources-&gt;js、css等资源</li>
<li>src\main\webapp\WEB-INF-&gt;外部浏览器不能访问到此文件夹的</li>
<li>src\main\webapp\WEB-INF\web.xml-&gt;初始化配置信息</li>
<li>src\main\webapp\index.jsp-&gt;</li>
<li>target-&gt;项目编译后的class文件</li>
</ul>
<h2 id="3-2引入文件jar包"><a href="#3-2引入文件jar包" class="headerlink" title="3.2引入文件jar包"></a>3.2引入文件jar包</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.3.7.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--单元测试--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 这个版本很重要 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--&lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--默认是compile环境,我们将此依赖使用在compile中--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1)包含Spring 框架基本的核心工具类。Spring 其它组件要都要使用到这个包里的类，是其它组件的基本核心 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2)这个jar 文件是所有应用都要用到的，它包含访问配置文件、创建和管理bean 以及进行Inversion of Control</span></span><br><span class="line"><span class="comment">        / Dependency Injection（IoC/DI）操作相关的所有类。如果应用只需基本的IoC/DI 支持，引入spring-core.jar</span></span><br><span class="line"><span class="comment">        及spring-beans.jar 文件就可以了。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3)这个jar 文件为Spring 核心提供了大量扩展。可以找到使用Spring ApplicationContext特性时所需的全部类，JDNI</span></span><br><span class="line"><span class="comment">        所需的全部类，instrumentation组件以及校验Validation 方面的相关类。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4) 这个jar 文件包含对Spring 对JDBC 数据访问进行封装的所有类。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 5) 为JDBC、Hibernate、JDO、JPA等提供的一致的声明式和编程式事务管理。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 6)Spring web 包含Web应用开发时，用到Spring框架时所需的核心类，包括自动载入WebApplicationContext特性的类、Struts与JSF集成类、文件上传的支持类、Filter类和大量工具辅助类。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 7)包含SpringMVC框架相关的所有类。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 8)Spring test 对JUNIT等测试框架的简单封装 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Servlet web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- json解析 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Map工具类 对标准java Collection的扩展 spring-core.jar需commons-collections.jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- DAO: MyBatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 图片处理 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.coobird/thumbnailator --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.coobird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thumbnailator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.4.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.penggle/kaptcha --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- redis客户端:Jedis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="4-项目配置文件"><a href="#4-项目配置文件" class="headerlink" title="4.项目配置文件"></a>4.项目配置文件</h1><h2 id="4-1数据库配置"><a href="#4-1数据库配置" class="headerlink" title="4.1数据库配置"></a>4.1数据库配置</h2><p>在src\resources下创建<code>jdbc.properties</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">#useUnicode因为要存储中文</span><br><span class="line">jdbc.url=jdbc:mysql://127.0.0.1:3306/o2o?useUnicode=true&amp;characterEncoding=utf8</span><br><span class="line">#jdbc.slave.url=jdbc:mysql://127.0.0.1:3306/o2o?useUnicode=true&amp;characterEncoding=utf8</span><br><span class="line">#jdbc.master.url=jdbc:mysql://120.24.64.163:3306/o2o?useUnicode=true&amp;characterEncoding=utf8</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=xiaoxin</span><br></pre></td></tr></table></figure>
<h2 id="4-2Mybatis配置"><a href="#4-2Mybatis配置" class="headerlink" title="4.2Mybatis配置"></a>4.2Mybatis配置</h2><p>在src\resources下创建<code>mybatis-config.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置全局属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用jdbc的getGeneratedKeys获取数据库自增主键值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 使用列标签(数据库中字段名)替换列别名(查询语句给字段自定义的名称) 默认:true --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 开启驼峰命名转换:Table&#123;create_time&#125; -&gt; Entity&#123;createTime&#125; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="4-3Spring配置文件"><a href="#4-3Spring配置文件" class="headerlink" title="4.3Spring配置文件"></a>4.3Spring配置文件</h2><h3 id="4-3-1Spring-dao"><a href="#4-3-1Spring-dao" class="headerlink" title="4.3.1Spring-dao"></a>4.3.1Spring-dao</h3><p>在src\resources\spring下创建<code>spring-dao.xml</code>文件</p>
<p>40</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置整合mybatis过程 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.配置数据库相关参数properties的属性：$&#123;url&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2.数据库连接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- c3p0连接池的私有属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 关闭连接后不自动commit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"autoCommitOnClose"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 获取连接超时时间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span> <span class="attr">value</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 当获取连接失败重试次数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireRetryAttempts"</span> <span class="attr">value</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.配置SqlSessionFactory对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据库连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis-config.xml"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 扫描entity包 使用别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"com.xiaoxin.entity"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 扫描sql配置文件:mapper需要的xml文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:mapper/*.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4.配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入sqlSessionFactory --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.xiaoxin.o2o.dao"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-2Spring-service"><a href="#4-3-2Spring-service" class="headerlink" title="4.3.2Spring-service"></a>4.3.2Spring-service</h3><p>在src\resources\spring下创建<code>spring-service.xml</code>文件</p>
<p>(19行再修改web.xml之后就好了)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 扫描service包下所有使用注解的类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xiaoxin.o2o.service"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据库连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置基于注解的声明式事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-3Spring-web"><a href="#4-3-3Spring-web" class="headerlink" title="4.3.3Spring-web"></a>4.3.3Spring-web</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置SpringMVC --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.开启SpringMVC注解模式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2.静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用"/"做整体映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/resources/**"</span> <span class="attr">location</span>=<span class="string">"/resources/"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.定义视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/html/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".html"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4.扫描web相关的bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xiaoxin.o2o.web"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-4修改web-xml"><a href="#4-3-4修改web-xml" class="headerlink" title="4.3.4修改web.xml"></a>4.3.4修改web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/spring-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 默认匹配所有的请求 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="5-验证Dao层"><a href="#5-验证Dao层" class="headerlink" title="5.验证Dao层"></a>5.验证Dao层</h1><h2 id="5-1添加AreaDao接口"><a href="#5-1添加AreaDao接口" class="headerlink" title="5.1添加AreaDao接口"></a>5.1添加AreaDao接口</h2><p>在<code>dao</code>包下创建<code>AreaDao</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AreaDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列出区域列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> areaList</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Area&gt; <span class="title">queryArea</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-2添加AreaDao-xml"><a href="#5-2添加AreaDao-xml" class="headerlink" title="5.2添加AreaDao.xml"></a>5.2添加AreaDao.xml</h2><p>在<code>src\resources\mapper</code>下创建<code>AreaDao.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xiaoxin.o2o.dao.AreaDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryArea"</span> <span class="attr">resultType</span>=<span class="string">"com.xiaoxin.o2o.entity.Area"</span>&gt;</span></span><br><span class="line">		SELECT area_id, area_name,</span><br><span class="line">		priority, create_time, last_edit_time</span><br><span class="line">		FROM tb_area</span><br><span class="line">		ORDER BY priority</span><br><span class="line">		DESC</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-3添加测试类"><a href="#5-3添加测试类" class="headerlink" title="5.3添加测试类"></a>5.3添加测试类</h2><h3 id="5-3-1创建BaseTest"><a href="#5-3-1创建BaseTest" class="headerlink" title="5.3.1创建BaseTest"></a>5.3.1创建BaseTest</h3><p>在<code>test\java</code>下创建<code>com.xiaoxin.o2o</code>包，在这个包下面创建<code>BaseTest.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2019/5/5</span></span><br><span class="line"><span class="comment"> * 配置spring和junit整合，junit启动时加载springIOC容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="comment">// 告诉junit spring配置文件的位置</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(&#123;<span class="string">"classpath:spring/spring-dao.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-3-2创建AreaDaoTest"><a href="#5-3-2创建AreaDaoTest" class="headerlink" title="5.3.2创建AreaDaoTest"></a>5.3.2创建AreaDaoTest</h3><p>在<code>src\test\java\com.xiaoxin.o2o</code>下创建<code>dao</code>包，在包下创建<code>AreaDaoTest.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AreaDaoTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AreaDao areaDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Area&gt; areaList = areaDao.queryArea();</span><br><span class="line">        assertEquals(<span class="number">2</span>, areaList.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-3-3创建测试数据"><a href="#5-3-3创建测试数据" class="headerlink" title="5.3.3创建测试数据"></a>5.3.3创建测试数据</h3><p>在<code>Navicat Premium</code>中的<code>tb_area</code>表中创建两条数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`tb_area`</span> (<span class="string">`area_name`</span>, <span class="string">`priority`</span>) <span class="keyword">VALUES</span> (<span class="string">'东苑'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`tb_area`</span> (<span class="string">`area_name`</span>, <span class="string">`priority`</span>) <span class="keyword">VALUES</span> (<span class="string">'西苑'</span>, <span class="string">'1'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="5-3-4报错处理"><a href="#5-3-4报错处理" class="headerlink" title="5.3.4报错处理"></a>5.3.4报错处理</h3><ul>
<li><p>第一个错误：junit的版本很重要<code>4.12</code></p>
</li>
<li><p>在连接数据库的时候又报时区错误，修改<code>resources</code>文件夹下的<code>jdbc.properties</code>文件中的连接数据库的链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc.url=jdbc:mysql://127.0.0.1:3306/o2o?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;serverTimezone=UTC</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="6-验证service层"><a href="#6-验证service层" class="headerlink" title="6.验证service层"></a>6.验证service层</h1><h2 id="6-1AreaService"><a href="#6-1AreaService" class="headerlink" title="6.1AreaService"></a>6.1AreaService</h2><h3 id="6-1-1接口"><a href="#6-1-1接口" class="headerlink" title="6.1.1接口"></a>6.1.1接口</h3><p>在<code>service</code>包中创建<code>AreaService</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AreaService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AREALISTKEY = <span class="string">"arealist"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取区域列表，优先从缓存获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Area&gt; <span class="title">getAreaList</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-1-2实现类"><a href="#6-1-2实现类" class="headerlink" title="6.1.2实现类"></a>6.1.2实现类</h3><p>在<code>service\impl</code>包下创建<code>AreaServiceImpl.java</code>文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dao.AreaDao;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.AreaService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AreaServiceImpl</span> <span class="keyword">implements</span> <span class="title">AreaService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AreaDao areaDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Area&gt; <span class="title">getAreaList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> areaDao.queryArea();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-2测试"><a href="#6-2测试" class="headerlink" title="6.2测试"></a>6.2测试</h2><h3 id="6-2-1修改BaseTest"><a href="#6-2-1修改BaseTest" class="headerlink" title="6.2.1修改BaseTest"></a>6.2.1修改BaseTest</h3><p>因为要测试<code>service</code>层，所以<code>BaseTest</code>要添加一个扫描，扫描到<code>service</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置spring和junit整合，junit启动时加载springIOC容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="comment">// 告诉junit spring配置文件的位置</span></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(&#123;<span class="string">"classpath:spring/spring-dao.xml"</span>,<span class="string">"classpath:spring/spring-service.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-2创建测试代码"><a href="#6-2-2创建测试代码" class="headerlink" title="6.2.2创建测试代码"></a>6.2.2创建测试代码</h3><p>创建<code>service</code>测试包，然后创建<code>AreaServiceTest.java</code>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AreaServiceTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AreaService areaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAreaList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Area&gt; areaList = areaService.getAreaList();</span><br><span class="line">        assertEquals(<span class="string">"东苑"</span>,areaList.get(<span class="number">0</span>).getAreaName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="7-验证Controller层"><a href="#7-验证Controller层" class="headerlink" title="7.验证Controller层"></a>7.验证Controller层</h1><p>在<code>web</code>包下创建<code>superadmin</code>包，在包下创建<code>AreaController</code></p>
<h2 id="7-1创建AreaController"><a href="#7-1创建AreaController" class="headerlink" title="7.1创建AreaController"></a>7.1创建AreaController</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.web.superadmin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.AreaService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/superadmin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AreaController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AreaService areaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/listarea"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="comment">// ↓这个标签标识自动将返回值转换为json格式</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">listArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        List&lt;Area&gt; list = <span class="keyword">new</span> ArrayList&lt;Area&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            list = areaService.getAreaList();</span><br><span class="line">            modelMap.put(<span class="string">"rows"</span>, list);</span><br><span class="line">            modelMap.put(<span class="string">"total"</span>, list.size());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-2验证"><a href="#7-2验证" class="headerlink" title="7.2验证"></a>7.2验证</h2><p>启动Tomcat之后，在浏览器里面输入项目对应接口<code>&lt;http://localhost:8080/superadmin/listarea&gt;</code></p>
<p>返回对应json数据</p>
<h1 id="8-日志管理"><a href="#8-日志管理" class="headerlink" title="8.日志管理"></a>8.日志管理</h1><p>Logback日志配置</p>
<h2 id="8-1Logback的主要模块"><a href="#8-1Logback的主要模块" class="headerlink" title="8.1Logback的主要模块"></a>8.1Logback的主要模块</h2><ul>
<li>logback-access-&gt;与service容器集成，提供访问HTTP的日志功能，第三放软件可以通过这个模块访问到日志</li>
<li>logback-classic-&gt;log4j的改良版本</li>
<li>logback-core-&gt;这个模块为前两个模块提供了基础服务</li>
</ul>
<h2 id="8-2Logback主要标签"><a href="#8-2Logback主要标签" class="headerlink" title="8.2Logback主要标签"></a>8.2Logback主要标签</h2><ul>
<li>logger-&gt;作为日志的记录器，主要用来存放日志对象，也可用定义日志的类型和级别</li>
<li>appender-&gt;指定日志的输出目的地，输出的媒介，可以是控制台、可以是文件、可以是远程字节服务器等</li>
<li>layout-&gt;格式化日志系统的输出的</li>
</ul>
<h2 id="8-3配置logback"><a href="#8-3配置logback" class="headerlink" title="8.3配置logback"></a>8.3配置logback</h2><h3 id="8-3-1创建logback-xml"><a href="#8-3-1创建logback-xml" class="headerlink" title="8.3.1创建logback.xml"></a>8.3.1创建logback.xml</h3><p>在<code>src\main\resources</code>下创建<code>logback.xml</code>文件</p>
<p>当然，如果不配置，那么<code>logback</code>又自己的默认配置，然后往控制台输出日志</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">"true"</span> <span class="attr">scanPeriod</span>=<span class="string">"60 seconds"</span> <span class="attr">debug</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义参数常量 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- TRACE&lt;DEBUG&lt;INFO&lt;WARN&lt;ERROR --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- logger.trace("msg") logger.debug... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"log.level"</span> <span class="attr">value</span>=<span class="string">"debug"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"log.maxHistory"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"log.filePath"</span> <span class="attr">value</span>=<span class="string">"$&#123;catalina.base&#125;/logs/webapps"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"log.pattern"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 控制台设置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"consoleAppender"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- DEBUG --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"debugAppender"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 文件路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.filePath&#125;/debug.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.filePath&#125;/debug/debug.%d&#123;yyyy-MM-dd&#125;.log.gz</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件最大保存历史数量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;log.maxHistory&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- INFO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"infoAppender"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 文件路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.filePath&#125;/info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.filePath&#125;/info/info.%d&#123;yyyy-MM-dd&#125;.log.gz</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件最大保存历史数量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;log.maxHistory&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ERROR --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"errorAppender"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 文件路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.filePath&#125;/erorr.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.filePath&#125;/error/error.%d&#123;yyyy-MM-dd&#125;.log.gz</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件最大保存历史数量 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;log.maxHistory&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;log.pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.xiaoxin.o2o"</span> <span class="attr">level</span>=<span class="string">"$&#123;log.level&#125;"</span> <span class="attr">additivity</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"debugAppender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"infoAppender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"errorAppender"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"consoleAppender"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个配置会将一定的日志分类保存为文件</p>
<h3 id="8-3-2验证配置"><a href="#8-3-2验证配置" class="headerlink" title="8.3.2验证配置"></a>8.3.2验证配置</h3><p>一般会在Controller层、service层打印日志的信息</p>
<p>修改<code>AreaController.java</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.web.superadmin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.AreaService;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/superadmin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AreaController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Logger logger = LoggerFactory.getLogger(AreaController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AreaService areaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/listarea"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="comment">// ↓这个标签标识自动将返回值转换为json格式</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">listArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"===start==="</span>);</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        List&lt;Area&gt; list = <span class="keyword">new</span> ArrayList&lt;Area&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            list = areaService.getAreaList();</span><br><span class="line">            modelMap.put(<span class="string">"rows"</span>, list);</span><br><span class="line">            modelMap.put(<span class="string">"total"</span>, list.size());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        logger.error(<span class="string">"test error!"</span>);</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        logger.debug(<span class="string">"costTime:[&#123;&#125;ms]"</span>, endTime - startTime);</span><br><span class="line">        logger.info(<span class="string">"===end==="</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 访问的时候并没有生成日志文件，不知道怎么回事</p>
</blockquote>
<h1 id="9-店铺管理系统"><a href="#9-店铺管理系统" class="headerlink" title="9.店铺管理系统"></a>9.店铺管理系统</h1><h2 id="9-1店铺创建"><a href="#9-1店铺创建" class="headerlink" title="9.1店铺创建"></a>9.1店铺创建</h2><h3 id="9-1-1创建ShopDao"><a href="#9-1-1创建ShopDao" class="headerlink" title="9.1.1创建ShopDao"></a>9.1.1创建ShopDao</h3><p>在<code>dao</code>包中创建<code>ShopDao</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShopDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增店铺</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shop</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertShop</span><span class="params">(Shop shop)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-1-2创建ShopDao-xml"><a href="#9-1-2创建ShopDao-xml" class="headerlink" title="9.1.2创建ShopDao.xml"></a>9.1.2创建ShopDao.xml</h3><p>在<code>src\resources\mapper</code>包下创建<code>ShopDao.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xiaoxin.o2o.dao.ShopDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertShop"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyColumn</span>=<span class="string">"shop_id"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">keyProperty</span>=<span class="string">"shopId"</span>&gt;</span></span><br><span class="line">		INSERT INTO</span><br><span class="line">		tb_shop(owner_id, area_id, shop_category_id,</span><br><span class="line">		shop_name, shop_desc, shop_addr,</span><br><span class="line">		phone, shop_img, priority,</span><br><span class="line">		create_time, last_edit_time, enable_status,</span><br><span class="line">		advice)</span><br><span class="line">		VALUES</span><br><span class="line">		(#&#123;owner.userId&#125;,#&#123;area.areaId&#125;,#&#123;shopCategory.shopCategoryId&#125;,#&#123;shopName&#125;,</span><br><span class="line">		#&#123;shopDesc&#125;,#&#123;shopAddr&#125;,#&#123;phone&#125;,#&#123;shopImg&#125;,#&#123;priority&#125;,</span><br><span class="line">		#&#123;createTime&#125;,#&#123;lastEditTime&#125;, #&#123;enableStatus&#125;,#&#123;advice&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>属性理解</strong></p>
<ul>
<li>useGeneratedKeys</li>
</ul>
<p><code>useGeneratedKeys=&quot;true&quot;</code>在<code>mybatis-config.xml</code>中有这么一段</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用jdbc的getGeneratedKeys获取数据库自增主键值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么在这里将这个属性设置为<code>true</code>之后，一但数据添加成功，我们就会通过<code>jdbc</code>获取主键的值，然后将它插入到获取的实体类中，因为当我们注册店铺的信息时，同时也要存储店铺的图片。我们要将这个店铺的图片存储在属于这个店铺的目录下。那么这导致了每个店铺的目录是不相同的，我们需要使用店铺的主键来区分目录，所以在存储图片的时候，需要使用店铺的主键。</p>
<ul>
<li>keyColumn</li>
</ul>
<p>设置主键,但是这里的值是数据库里的内容。</p>
<ul>
<li>keyProperty</li>
</ul>
<p>设置主键，这里是实体类中的写法</p>
<p><strong>注意</strong></p>
<p>因为这个实体它有三个外键，<code>owner</code>所属人、<code>area</code>所属地区、<code>shopCategory</code>店铺类别。</p>
<p>所以我们要先在数据库里面添加对应的外键。</p>
<p>在上面的sql语句中<code>#{owner.userId}</code>的执行会获取<code>PersonInfo</code>的<code>getUserId</code>方法。从而获取对应的<code>id</code>存到数据库中。</p>
<p>添加外键实体</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`tb_person_info`</span> (<span class="string">`name`</span>, <span class="string">`profile_img`</span>, <span class="string">`email`</span>, <span class="string">`gender`</span>, <span class="string">`enable_status`</span>, <span class="string">`user_type`</span>) <span class="keyword">VALUES</span> (<span class="string">'小英'</span>, <span class="string">'test'</span>, <span class="string">'test'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>)</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`tb_shop_category`</span> (<span class="string">`shop_category_name`</span>, <span class="string">`shop_category_desc`</span>, <span class="string">`shop_category_img`</span>, <span class="string">`priority`</span>) <span class="keyword">VALUES</span> (<span class="string">'咖啡奶茶'</span>, <span class="string">'咖啡奶茶'</span>, <span class="string">'test'</span>, <span class="string">'1'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="9-1-3测试类"><a href="#9-1-3测试类" class="headerlink" title="9.1.3测试类"></a>9.1.3测试类</h3><p>在<code>src\test\java\com.xiaoxin.o2o\dao</code>下创建<code>ShopDaoTest</code>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.PersonInfo;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopDaoTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopDao shopDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertShop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Shop shop = <span class="keyword">new</span> Shop();</span><br><span class="line">        PersonInfo owner = <span class="keyword">new</span> PersonInfo();</span><br><span class="line">        Area area = <span class="keyword">new</span> Area();</span><br><span class="line">        ShopCategory shopCategory = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">        owner.setUserId(<span class="number">1L</span>);</span><br><span class="line">        area.setAreaId(<span class="number">3</span>);</span><br><span class="line">        shopCategory.setShopCategoryId(<span class="number">36L</span>);</span><br><span class="line">        shop.setOwner(owner);</span><br><span class="line">        shop.setArea(area);</span><br><span class="line">        shop.setShopCategory(shopCategory);</span><br><span class="line">        shop.setShopName(<span class="string">"测试的店铺"</span>);</span><br><span class="line">        shop.setShopDesc(<span class="string">"test"</span>);</span><br><span class="line">        shop.setShopAddr(<span class="string">"test"</span>);</span><br><span class="line">        shop.setPhone(<span class="string">"test"</span>);</span><br><span class="line">        shop.setShopImg(<span class="string">"test"</span>);</span><br><span class="line">        shop.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        shop.setEnableStatus(<span class="number">1</span>);</span><br><span class="line">        shop.setAdvice(<span class="string">"审核中"</span>);</span><br><span class="line">        <span class="keyword">int</span> effectedNum = shopDao.insertShop(shop);</span><br><span class="line">        assertEquals(<span class="number">1</span>, effectedNum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<h2 id="9-2店铺修改"><a href="#9-2店铺修改" class="headerlink" title="9.2店铺修改"></a>9.2店铺修改</h2><h3 id="9-2-1修改ShopDao"><a href="#9-2-1修改ShopDao" class="headerlink" title="9.2.1修改ShopDao"></a>9.2.1修改ShopDao</h3><p>在<code>src\main\java\dao\ShopDao.java</code>文件中添加一个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 更新店铺信息</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> shop</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateShop</span><span class="params">(Shop shop)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="9-2-2修改ShopDao-xml"><a href="#9-2-2修改ShopDao-xml" class="headerlink" title="9.2.2修改ShopDao.xml"></a>9.2.2修改ShopDao.xml</h3><p>修改<code>src\resources\mapper\ShopDao.xml</code>文件</p>
<p>在文件中添加一个方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateShop"</span> <span class="attr">parameterType</span>=<span class="string">"com.xiaoxin.o2o.entity.Shop"</span>&gt;</span></span><br><span class="line">    update tb_shop</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopName != null"</span>&gt;</span>shop_name=#&#123;shopName&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopDesc != null"</span>&gt;</span>shop_desc=#&#123;shopDesc&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopAddr != null"</span>&gt;</span>shop_addr=#&#123;shopAddr&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>phone=#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopImg != null"</span>&gt;</span>shop_img=#&#123;shopImg&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"priority != null"</span>&gt;</span>priority=#&#123;priority&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"lastEditTime != null"</span>&gt;</span>last_edit_time=#&#123;lastEditTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"enableStatus != null"</span>&gt;</span>enable_status=#&#123;enableStatus&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"advice != null"</span>&gt;</span>advice=#&#123;advice&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"area != null"</span>&gt;</span>area_id=#&#123;area.areaId&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCategory != null"</span>&gt;</span>shop_category_id=#&#123;shopCategory.shopCategoryId&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where shop_id=#&#123;shopId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-2-3测试类"><a href="#9-2-3测试类" class="headerlink" title="9.2.3测试类"></a>9.2.3测试类</h3><p>在<code>src\test\java\com.xiaoxin.o2o\dao\ShopDaoTest.java</code>测试类中</p>
<p>添加一个测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateShop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Shop shop = <span class="keyword">new</span> Shop();</span><br><span class="line">    shop.setShopId(<span class="number">36L</span>);</span><br><span class="line">    shop.setShopDesc(<span class="string">"测试描述"</span>);</span><br><span class="line">    shop.setShopAddr(<span class="string">"测试地址"</span>);</span><br><span class="line">    shop.setLastEditTime(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="keyword">int</span> effectedNum = shopDao.updateShop(shop);</span><br><span class="line">    assertEquals(<span class="number">1</span>, effectedNum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其中给之前的测试方法加上<code>@Ignore</code>注解，标识这个测试类不执行</p>
<p>测试成功</p>
</blockquote>
<h2 id="9-3水印处理"><a href="#9-3水印处理" class="headerlink" title="9.3水印处理"></a>9.3水印处理</h2><h3 id="9-3-1添加依赖"><a href="#9-3-1添加依赖" class="headerlink" title="9.3.1添加依赖"></a>9.3.1添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.coobird<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thumbnailator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.4.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>之前在<code>pom</code>里面已经添加了</p>
</blockquote>
<h3 id="9-3-2图片准备"><a href="#9-3-2图片准备" class="headerlink" title="9.3.2图片准备"></a>9.3.2图片准备</h3><ol>
<li>在<code>src\main\resources</code>下准备一张小图片用来当水印</li>
</ol>
<blockquote>
<p>透明图片，<a href="https://www.jb51.net/photoshop/434783.html" target="_blank" rel="noopener">参考网址</a></p>
</blockquote>
<ol start="2">
<li>需要添加水印的图片，位置任意。</li>
</ol>
<blockquote>
<p>我的图片</p>
</blockquote>
<p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\MyLogo.png" alt="MyLogo.png"></p>
<p><img src="/2019/05/08/课程项目/F:/学习文件\Typora文档\SchoolProject\lanerge.jpg" alt="lanerge.jpg"></p>
<h3 id="9-3-3图片工具类"><a href="#9-3-3图片工具类" class="headerlink" title="9.3.3图片工具类"></a>9.3.3图片工具类</h3><p>在<code>src\main\java\util</code>包下创建一个<code>ImageUtil.java</code>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.coobird.thumbnailator.Thumbnails;</span><br><span class="line"><span class="keyword">import</span> net.coobird.thumbnailator.geometry.Positions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String basePath = Thread.currentThread().getContextClassLoader().getResource(<span class="string">""</span>).getPath();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Thumbnails.of(<span class="keyword">new</span> File(<span class="string">"F://ThumbnailsTest/lanerge.jpg"</span>)).size(<span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">                .watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="keyword">new</span> File(basePath + <span class="string">"/MyLogo.png"</span>)), <span class="number">0.8f</span>)</span><br><span class="line">                .outputQuality(<span class="number">0.8f</span>).toFile(<span class="string">"F://ThumbnailsTest/lanerge_fidel.jpg"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>运行主函数，加水印成功！</p>
</blockquote>
<p><strong>代码解释</strong></p>
<ul>
<li><code>.size(200,200)</code></li>
</ul>
<p>这个是输出图片的大小。像素为单位</p>
<ul>
<li><code>.watermark()</code></li>
</ul>
<p>添加水印，这个函数有三个参数。</p>
<p>第一个：水印的位置</p>
<p>第二个：水印图片的路径</p>
<p>​        由于我们这个方法是通过线程去执行的。所以我们可以通过线程去逆推到这个线程的类加载器。从而从这个类加载器得到它的资源的路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String basePath = Thread.currentThread().getContextClassLoader().getResource(<span class="string">""</span>).getPath();</span><br></pre></td></tr></table></figure>
<p>像上面这样就可以得到，<code>classpath</code>的绝对路径了。</p>
<p>第三个：透明度</p>
<ul>
<li><code>.outputQuality(0.8f)</code></li>
</ul>
<p>输出的图片压缩比</p>
<ul>
<li><code>.toFile()</code></li>
</ul>
<p>输出的地址</p>
<h2 id="9-4路径工具类"><a href="#9-4路径工具类" class="headerlink" title="9.4路径工具类"></a>9.4路径工具类</h2><p>由于上面的图片工具类为例，项目需要使用到一些复杂的路径，所以我们将这些功能封装成一个工具类。</p>
<p>在<code>util</code>包下面创建<code>PathUtil</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String seperator = System.getProperty(<span class="string">"file.separator"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getImgBasePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String os = System.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">		String basePath = <span class="string">""</span>;</span><br><span class="line">		<span class="keyword">if</span> (os.toLowerCase().startsWith(<span class="string">"win"</span>)) &#123;</span><br><span class="line">			basePath = <span class="string">"D:/projectdev/image"</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			basePath = <span class="string">"/Users/baidu/work/image"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		basePath = basePath.replace(<span class="string">"/"</span>, seperator);</span><br><span class="line">		<span class="keyword">return</span> basePath;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getShopImagePath</span><span class="params">(<span class="keyword">long</span> shopId)</span> </span>&#123;</span><br><span class="line">		String imagePath = <span class="string">"/upload/images/item/shop/"</span> + shopId + <span class="string">"/"</span>;</span><br><span class="line">		<span class="keyword">return</span> imagePath.replace(<span class="string">"/"</span>, seperator);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-5图片缩略处理"><a href="#9-5图片缩略处理" class="headerlink" title="9.5图片缩略处理"></a>9.5图片缩略处理</h2><p>门面照，或者是商品的小图片等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.coobird.thumbnailator.Thumbnails;</span><br><span class="line"><span class="keyword">import</span> net.coobird.thumbnailator.geometry.Positions;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String basePath = Thread.currentThread().getContextClassLoader().getResource(<span class="string">""</span>).getPath();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SimpleDateFormat sDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmss"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Random r = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(ImageUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将CommonsMultipartFile转换成File类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">transferCommonsMultipartFileToFile</span><span class="params">(CommonsMultipartFile cFile)</span> </span>&#123;</span><br><span class="line">        File newFile = <span class="keyword">new</span> File(cFile.getOriginalFilename());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cFile.transferTo(newFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            logger.error(e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理缩略图</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> thumbnail</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetAddr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateThumbnail</span><span class="params">(File thumbnail, String targetAddr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取不重复的随机名</span></span><br><span class="line">        String realFileName = getRandomFileName();</span><br><span class="line">        <span class="comment">// 获取文件的扩展名如png,jpg等</span></span><br><span class="line">        String extension = getFileExtension(thumbnail);</span><br><span class="line">        <span class="comment">// 如果目标路径不存在，则自动创建</span></span><br><span class="line">        makeDirPath(targetAddr);</span><br><span class="line">        <span class="comment">// 获取文件存储的相对路径(带文件名)</span></span><br><span class="line">        String relativeAddr = targetAddr + realFileName + extension;</span><br><span class="line">        logger.debug(<span class="string">"current relativeAddr is :"</span> + relativeAddr);</span><br><span class="line">        <span class="comment">// 获取文件要保存到的目标路径</span></span><br><span class="line">        File dest = <span class="keyword">new</span> File(PathUtil.getImgBasePath() + relativeAddr);</span><br><span class="line">        logger.debug(<span class="string">"current complete addr is :"</span> + PathUtil.getImgBasePath() + relativeAddr);</span><br><span class="line">        logger.debug(<span class="string">"basePath is :"</span> + basePath);</span><br><span class="line">        <span class="comment">// 调用Thumbnails生成带有水印的图片</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thumbnails.of(thumbnail).size(<span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">                    .watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="keyword">new</span> File(basePath + <span class="string">"/MyLogo.png"</span>)), <span class="number">0.25f</span>)</span><br><span class="line">                    .outputQuality(<span class="number">0.8f</span>).toFile(dest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(e.toString());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"创建缩略图失败："</span> + e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回图片相对路径地址</span></span><br><span class="line">        <span class="keyword">return</span> relativeAddr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机文件名，当前年月日小时分钟秒钟+五位随机数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRandomFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取随机的五位数</span></span><br><span class="line">        <span class="keyword">int</span> rannum = r.nextInt(<span class="number">89999</span>) + <span class="number">10000</span>;</span><br><span class="line">        String nowTimeStr = sDateFormat.format(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> nowTimeStr + rannum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取输入文件流的扩展名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getFileExtension</span><span class="params">(File cFile)</span> </span>&#123;</span><br><span class="line">        String originalFileName = cFile.getName();</span><br><span class="line">        <span class="keyword">return</span> originalFileName.substring(originalFileName.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建目标路径所涉及到的目录，即/home/work/xiangze/xxx.jpg, 那么 home work xiangze</span></span><br><span class="line"><span class="comment">     * 这三个文件夹都得自动创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetAddr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">makeDirPath</span><span class="params">(String targetAddr)</span> </span>&#123;</span><br><span class="line">        String realFileParentPath = PathUtil.getImgBasePath() + targetAddr;</span><br><span class="line">        File dirPath = <span class="keyword">new</span> File(realFileParentPath);</span><br><span class="line">        <span class="keyword">if</span> (!dirPath.exists()) &#123;</span><br><span class="line">            dirPath.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Thumbnails.of(<span class="keyword">new</span> File(<span class="string">"F://ThumbnailsTest/lanerge.jpg"</span>)).size(<span class="number">960</span>, <span class="number">960</span>)</span><br><span class="line">                .watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="keyword">new</span> File(basePath + <span class="string">"/MyLogo.png"</span>)), <span class="number">0.8f</span>)</span><br><span class="line">                .outputQuality(<span class="number">0.8f</span>).toFile(<span class="string">"F://ThumbnailsTest/lanerge_fidel.jpg"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-6店铺注册Dto层"><a href="#9-6店铺注册Dto层" class="headerlink" title="9.6店铺注册Dto层"></a>9.6店铺注册Dto层</h2><p>因为创建店铺之后我们不能直接返回一个实体类，我们要返回实体类和一些额外的东西，所以这里就需要使用实体类<code>Dao</code>扩展出新的<code>Dto</code>层</p>
<p>在<code>Dto</code>层创建一个<code>ShopExecution</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopExecution</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 结果状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态标识</span></span><br><span class="line">    <span class="keyword">private</span> String stateInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 店铺数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作的shop(增删改店铺的时候用到)</span></span><br><span class="line">    <span class="keyword">private</span> Shop shop;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// shop列表(查询店铺列表的时候使用)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Shop&gt; shopList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopExecution</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 店铺操作失败的时候使用的构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopExecution</span><span class="params">(ShopStateEnum stateEnum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = stateEnum.getState();</span><br><span class="line">        <span class="keyword">this</span>.stateInfo = stateEnum.getStateInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 店铺操作成功的时候使用的构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopExecution</span><span class="params">(ShopStateEnum stateEnum, Shop shop)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = stateEnum.getState();</span><br><span class="line">        <span class="keyword">this</span>.stateInfo = stateEnum.getStateInfo();</span><br><span class="line">        <span class="keyword">this</span>.shop = shop;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 店铺操作成功的时候使用的构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopExecution</span><span class="params">(ShopStateEnum stateEnum, List&lt;Shop&gt; shopList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = stateEnum.getState();</span><br><span class="line">        <span class="keyword">this</span>.stateInfo = stateEnum.getStateInfo();</span><br><span class="line">        <span class="keyword">this</span>.shopList = shopList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// get &amp; set 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为我们还需要用到枚举类，所以这里在<code>enums</code>包中创建<code>ShopStateEnum.java</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ShopStateEnum &#123;</span><br><span class="line">    CHECK(<span class="number">0</span>, <span class="string">"审核中"</span>),</span><br><span class="line">    OFFLINE(-<span class="number">1</span>, <span class="string">"非法店铺"</span>),</span><br><span class="line">    SUCCESS(<span class="number">1</span>, <span class="string">"操作成功"</span>),</span><br><span class="line">    PASS(<span class="number">2</span>, <span class="string">"通过认证"</span>),</span><br><span class="line">    INNER_ERROR(-<span class="number">1001</span>, <span class="string">"内部系统错误"</span>),</span><br><span class="line">    NULL_SHOPID(-<span class="number">1002</span>, <span class="string">"ShopId为空"</span>),</span><br><span class="line">    NULL_SHOP(-<span class="number">1003</span>, <span class="string">"shop信息为空"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> state;</span><br><span class="line">    <span class="keyword">private</span> String stateInfo;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ShopStateEnum</span><span class="params">(<span class="keyword">int</span> state, String stateInfo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">        <span class="keyword">this</span>.stateInfo = stateInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 依据传入的state返回相应的enum值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ShopStateEnum <span class="title">stateOf</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (ShopStateEnum stateEnum : values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (stateEnum.getState() == state) &#123;</span><br><span class="line">                <span class="keyword">return</span> stateEnum;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStateInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stateInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-7店铺注册Service层"><a href="#9-7店铺注册Service层" class="headerlink" title="9.7店铺注册Service层"></a>9.7店铺注册Service层</h2><p>Service层是注重对事务的处理，一个店铺的注册，首先是要将店铺的信息插入到数据库中，然后返回店铺ID。然后通过这个ID创建存储这个店铺的图片的文件夹。然后再把这个文件夹的路径更新到数据库里面去。这四步就是事务，其中任何一步出错，我们都需要进行事务的回滚。</p>
<h3 id="9-7-1创建ShopService"><a href="#9-7-1创建ShopService" class="headerlink" title="9.7.1创建ShopService"></a>9.7.1创建ShopService</h3><p>在<code>service</code>包下创建<code>ShopService.java</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dao.ShopDao;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.exceptions.ShopOperationException;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.PathUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopDao shopDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShopExecution <span class="title">addShop</span><span class="params">(Shop shop, File shopImg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空值判断</span></span><br><span class="line">        <span class="keyword">if</span> (shop == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.NULL_SHOP);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 给店铺信息赋初始值</span></span><br><span class="line">            shop.setEnableStatus(<span class="number">0</span>);</span><br><span class="line">            shop.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">            shop.setLastEditTime(<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="comment">// 添加店铺信息</span></span><br><span class="line">            <span class="keyword">int</span> effectedNum = shopDao.insertShop(shop);</span><br><span class="line">            <span class="keyword">if</span> (effectedNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// RuntimeException会终止回滚事务</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"店铺创建失败"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (shopImg != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 存储图片</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        addShopImg(shop, shopImg);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"addShopImg error:"</span> + e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 更新店铺的图片地址</span></span><br><span class="line">                    effectedNum = shopDao.updateShop(shop);</span><br><span class="line">                    <span class="keyword">if</span> (effectedNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"更新图片地址失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"addShop error:"</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.CHECK, shop);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addShopImg</span><span class="params">(Shop shop, File shopImg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取shop图片目录的相对值路径</span></span><br><span class="line">        String dest = PathUtil.getShopImagePath(shop.getShopId());</span><br><span class="line">        String shopImgAddr = ImageUtil.generateThumbnail(shopImg, dest);</span><br><span class="line">        shop.setShopImg(shopImgAddr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-7-2扩展RuntimeException"><a href="#9-7-2扩展RuntimeException" class="headerlink" title="9.7.2扩展RuntimeException"></a>9.7.2扩展RuntimeException</h3><p>我们不能把所有的事务报错都使用<code>RuntimeException</code>来处理，我们要自定义错误处理机制。</p>
<p>在<code>src\main\java</code>下创建<code>exceptions</code>，在下面创建<code>ShopOperationException.java</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.exceptions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopOperationException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓序列化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2361446884822298905L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopOperationException</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将原来Service中的<code>RuntimeException</code>全部替换成<code>ShopOperationException</code></p>
<h3 id="9-7-3测试"><a href="#9-7-3测试" class="headerlink" title="9.7.3测试"></a>9.7.3测试</h3><p>将<code>MyLogo.png</code>图片也放到<code>test\resources</code>包下</p>
<p>在<code>test\java\service</code>中创建<code>ShopServiceTest</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.PersonInfo;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.exceptions.ShopOperationException;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopServiceTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopService shopService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddShop</span><span class="params">()</span> <span class="keyword">throws</span> ShopOperationException, FileNotFoundException </span>&#123;</span><br><span class="line">        Shop shop = <span class="keyword">new</span> Shop();</span><br><span class="line">        PersonInfo owner = <span class="keyword">new</span> PersonInfo();</span><br><span class="line">        Area area = <span class="keyword">new</span> Area();</span><br><span class="line">        ShopCategory shopCategory = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">        owner.setUserId(<span class="number">1L</span>);</span><br><span class="line">        area.setAreaId(<span class="number">3</span>);</span><br><span class="line">        shopCategory.setShopCategoryId(<span class="number">36L</span>);</span><br><span class="line">        shop.setOwner(owner);</span><br><span class="line">        shop.setArea(area);</span><br><span class="line">        shop.setShopCategory(shopCategory);</span><br><span class="line">        shop.setShopName(<span class="string">"测试的店铺3"</span>);</span><br><span class="line">        shop.setShopDesc(<span class="string">"test3"</span>);</span><br><span class="line">        shop.setShopAddr(<span class="string">"test3"</span>);</span><br><span class="line">        shop.setPhone(<span class="string">"test3"</span>);</span><br><span class="line">        shop.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        shop.setEnableStatus(ShopStateEnum.CHECK.getState());</span><br><span class="line">        shop.setAdvice(<span class="string">"审核中"</span>);</span><br><span class="line">        File shopImg = <span class="keyword">new</span> File(<span class="string">"F://ThumbnailsTest/lanerge.jpg"</span>);</span><br><span class="line">        ShopExecution se = shopService.addShop(shop, shopImg );</span><br><span class="line">        assertEquals(ShopStateEnum.CHECK.getState(), se.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试是成功了，但是事务失败后并没有回滚事务</p>
</blockquote>
<h2 id="9-8店铺注册Controller层"><a href="#9-8店铺注册Controller层" class="headerlink" title="9.8店铺注册Controller层"></a>9.8店铺注册Controller层</h2><h3 id="9-8-1HTTP请求工具类"><a href="#9-8-1HTTP请求工具类" class="headerlink" title="9.8.1HTTP请求工具类"></a>9.8.1HTTP请求工具类</h3><p>在浏览器发送HTTP请求的时候，我们需要进行一定的处理</p>
<p>在<code>util</code>包下创建<code>HttpServletRequestUtil</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServletRequestUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 大致都是通过key从request获取值，然后转换类型，然后输出</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getInt</span><span class="params">(HttpServletRequest request, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.decode(request.getParameter(key));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getLong</span><span class="params">(HttpServletRequest request, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Long.valueOf(request.getParameter(key));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Double <span class="title">getDouble</span><span class="params">(HttpServletRequest request, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Double.valueOf(request.getParameter(key));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>d;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">getBoolean</span><span class="params">(HttpServletRequest request, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Boolean.valueOf(request.getParameter(key));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getString</span><span class="params">(HttpServletRequest request, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String result = request.getParameter(key);</span><br><span class="line">            <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">                result = result.trim();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">""</span>.equals(result)) &#123;</span><br><span class="line">                result = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-8-2JSON转换"><a href="#9-8-2JSON转换" class="headerlink" title="9.8.2JSON转换"></a>9.8.2JSON转换</h3><p>在<code>pom</code>文件中<code>jackson</code>是用来转换实体与json的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- json解析 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-8-3创建控制类"><a href="#9-8-3创建控制类" class="headerlink" title="9.8.3创建控制类"></a>9.8.3创建控制类</h3><p>在<code>web</code>包下创建<code>shopadmin</code>包，然后创建<code>ShopManagementController</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.web.shopadmin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.PersonInfo;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.exceptions.ShopOperationException;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.AreaService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.HttpServletRequestUtil;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.PathUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartHttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/shopadmin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopManagementController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopService shopService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/registershop"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">registerShop</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ↓要返回给前端的一些关键键值对</span></span><br><span class="line">        Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="comment">// 1.接收并转化相应的参数，包括店铺信息以及图片信息</span></span><br><span class="line">        <span class="comment">// ↓从请求的request获取key是shopStr的变量值</span></span><br><span class="line">        String shopStr = HttpServletRequestUtil.getString(request, <span class="string">"shopStr"</span>);</span><br><span class="line">        <span class="comment">// ↓实体转换JSON需要的类</span></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        Shop shop = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ↓实体转换JSON</span></span><br><span class="line">            shop = mapper.readValue(shopStr, Shop.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// ↓如果报错了</span></span><br><span class="line">            <span class="comment">// ↓往前端返回一个‘是否成功’，值为false</span></span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">// ↓并且把失败的信息也传给前端，key是errMsg</span></span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ↓这是一个接收图片的类</span></span><br><span class="line">        CommonsMultipartFile shopImg = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// ↓文件上传解析器类，用来解析request中的文件</span></span><br><span class="line">        CommonsMultipartResolver commonsMultipartResolver = <span class="keyword">new</span> CommonsMultipartResolver(</span><br><span class="line">                <span class="comment">// ↓通过这个请求的session的上下文去解析这个request</span></span><br><span class="line">                request.getSession().getServletContext());</span><br><span class="line">        <span class="comment">// ↓判断这个request中是否有上传文件流</span></span><br><span class="line">        <span class="keyword">if</span> (commonsMultipartResolver.isMultipart(request)) &#123;</span><br><span class="line">            <span class="comment">// ↓有上传文件流，我们需将request强行转换成multipartHttpServletRequest</span></span><br><span class="line">            MultipartHttpServletRequest multipartHttpServletRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">            <span class="comment">// ↓只有将request转换为multipartHttpServletRequest，我们才能从multipartHttpServletRequest中提取图片文件流</span></span><br><span class="line">            shopImg = (CommonsMultipartFile) multipartHttpServletRequest.getFile(<span class="string">"shopImg"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ↓没有文件流，向前端报错</span></span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"上传图片不能为空"</span>);</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.注册店铺</span></span><br><span class="line">        <span class="comment">// ↓判断店铺和图片是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (shop != <span class="keyword">null</span> &amp;&amp; shopImg != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//            PersonInfo owner = (PersonInfo) request.getSession().getAttribute("user");</span></span><br><span class="line">            <span class="comment">// ↓这里应该使用session去拿取用户的，后期再改</span></span><br><span class="line">            PersonInfo owner = <span class="keyword">new</span> PersonInfo();</span><br><span class="line">            owner.setUserId(<span class="number">1L</span>);</span><br><span class="line">            shop.setOwner(owner);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ↓这个没实现前端，没上传的图片，在代码里面拿取一个本地静态的图片</span></span><br><span class="line">            <span class="comment">// ↓生成文件名</span></span><br><span class="line">            File shopImgFile = <span class="keyword">new</span> File(PathUtil.getImgBasePath() + ImageUtil.getRandomFileName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// ↓创建文件</span></span><br><span class="line">                shopImgFile.createNewFile();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">                <span class="keyword">return</span> modelMap;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStreamToFile(shopImg.getInputStream(), shopImgFile);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">                <span class="keyword">return</span> modelMap;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 店铺实体类的dto扩展类</span></span><br><span class="line">            ShopExecution se = shopService.addShop(shop, shopImgFile);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (se.getState() == ShopStateEnum.CHECK.getState()) &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ↓为空，向前端报错</span></span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"请输入店铺信息"</span>);</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将CommonsMultipartFile转换为File，不然shopService.addShop(shop, imageHolder)的第二个参数接收不了</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">inputStreamToFile</span><span class="params">(InputStream ins, File file)</span> </span>&#123;</span><br><span class="line">        FileOutputStream os = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            os = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">            <span class="keyword">int</span> bytesRead = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((bytesRead = ins.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                os.write(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"调用inputStreamToFile产生异常"</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (os != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    os.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ins != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    ins.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"inputStreamToFile关闭产生io异常"</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-9店铺注册优化"><a href="#9-9店铺注册优化" class="headerlink" title="9.9店铺注册优化"></a>9.9店铺注册优化</h2><p>因为之前有一个File转换为CommonsMultipartFile的过程，这个很不好，所以我们进行一次大换血</p>
<h3 id="9-9-1修改ShopService接口"><a href="#9-9-1修改ShopService接口" class="headerlink" title="9.9.1修改ShopService接口"></a>9.9.1修改ShopService接口</h3><p><code>ShopService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShopService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">ShopExecution <span class="title">addShop</span><span class="params">(Shop shop, InputStream shopImgInputStream,String fileName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从这里开始我们直接传入<code>InputStream</code>，因为<code>InputStream</code>没有办法获取文件的名字，所以再传入一个文件名字</p>
<p>而这个名字在图片工具类中需要使用文件的名字来获取图片的扩展名</p>
</blockquote>
<h3 id="9-9-2修改实现类"><a href="#9-9-2修改实现类" class="headerlink" title="9.9.2修改实现类"></a>9.9.2修改实现类</h3><p><code>ShopServiceImpl</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dao.ShopDao;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.exceptions.ShopOperationException;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.PathUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopDao shopDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShopExecution <span class="title">addShop</span><span class="params">(Shop shop, InputStream shopImgInputStream, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 空值判断</span></span><br><span class="line">        <span class="keyword">if</span> (shop == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.NULL_SHOP);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 给店铺信息赋初始值</span></span><br><span class="line">            shop.setEnableStatus(<span class="number">0</span>);</span><br><span class="line">            shop.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">            shop.setLastEditTime(<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="comment">// 添加店铺信息</span></span><br><span class="line">            <span class="keyword">int</span> effectedNum = shopDao.insertShop(shop);</span><br><span class="line">            <span class="keyword">if</span> (effectedNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// RuntimeException会终止回滚事务</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"店铺创建失败"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (shopImgInputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 存储图片</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        addShopImg(shop, shopImgInputStream, fileName);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"addShopImg error:"</span> + e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 更新店铺的图片地址</span></span><br><span class="line">                    effectedNum = shopDao.updateShop(shop);</span><br><span class="line">                    <span class="keyword">if</span> (effectedNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"更新图片地址失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"addShop error:"</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.CHECK, shop);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addShopImg</span><span class="params">(Shop shop, InputStream shopImgInputStream, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取shop图片目录的相对值路径</span></span><br><span class="line">        String dest = PathUtil.getShopImagePath(shop.getShopId());</span><br><span class="line">        String shopImgAddr = ImageUtil.generateThumbnail(shopImgInputStream,fileName, dest);</span><br><span class="line">        shop.setShopImg(shopImgAddr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-9-3修改工具类"><a href="#9-9-3修改工具类" class="headerlink" title="9.9.3修改工具类"></a>9.9.3修改工具类</h3><p><code>ImageUtil</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.coobird.thumbnailator.Thumbnails;</span><br><span class="line"><span class="keyword">import</span> net.coobird.thumbnailator.geometry.Positions;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String basePath = Thread.currentThread().getContextClassLoader().getResource(<span class="string">""</span>).getPath();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SimpleDateFormat sDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmss"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Random r = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(ImageUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将CommonsMultipartFile转换成File类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cFile</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">transferCommonsMultipartFileToFile</span><span class="params">(CommonsMultipartFile cFile)</span> </span>&#123;</span><br><span class="line">        File newFile = <span class="keyword">new</span> File(cFile.getOriginalFilename());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cFile.transferTo(newFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">            logger.error(e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理缩略图</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetAddr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateThumbnail</span><span class="params">(InputStream thumbnailInputStream, String fileName, String targetAddr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取不重复的随机名</span></span><br><span class="line">        String realFileName = getRandomFileName();</span><br><span class="line">        <span class="comment">// 获取文件的扩展名如png,jpg等</span></span><br><span class="line">        String extension = getFileExtension(fileName);</span><br><span class="line">        <span class="comment">// 如果目标路径不存在，则自动创建</span></span><br><span class="line">        makeDirPath(targetAddr);</span><br><span class="line">        <span class="comment">// 获取文件存储的相对路径(带文件名)</span></span><br><span class="line">        String relativeAddr = targetAddr + realFileName + extension;</span><br><span class="line">        logger.debug(<span class="string">"current relativeAddr is :"</span> + relativeAddr);</span><br><span class="line">        <span class="comment">// 获取文件要保存到的目标路径</span></span><br><span class="line">        File dest = <span class="keyword">new</span> File(PathUtil.getImgBasePath() + relativeAddr);</span><br><span class="line">        logger.debug(<span class="string">"current complete addr is :"</span> + PathUtil.getImgBasePath() + relativeAddr);</span><br><span class="line">        logger.debug(<span class="string">"basePath is :"</span> + basePath);</span><br><span class="line">        <span class="comment">// 调用Thumbnails生成带有水印的图片</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thumbnails.of(thumbnailInputStream).size(<span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">                    .watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="keyword">new</span> File(basePath + <span class="string">"/MyLogo.png"</span>)), <span class="number">0.25f</span>)</span><br><span class="line">                    .outputQuality(<span class="number">0.8f</span>).toFile(dest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(e.toString());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"创建缩略图失败："</span> + e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回图片相对路径地址</span></span><br><span class="line">        <span class="keyword">return</span> relativeAddr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机文件名，当前年月日小时分钟秒钟+五位随机数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRandomFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取随机的五位数</span></span><br><span class="line">        <span class="keyword">int</span> rannum = r.nextInt(<span class="number">89999</span>) + <span class="number">10000</span>;</span><br><span class="line">        String nowTimeStr = sDateFormat.format(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> nowTimeStr + rannum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取输入文件流的扩展名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getFileExtension</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建目标路径所涉及到的目录，即/home/work/xiangze/xxx.jpg, 那么 home work xiangze</span></span><br><span class="line"><span class="comment">     * 这三个文件夹都得自动创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetAddr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">makeDirPath</span><span class="params">(String targetAddr)</span> </span>&#123;</span><br><span class="line">        String realFileParentPath = PathUtil.getImgBasePath() + targetAddr;</span><br><span class="line">        File dirPath = <span class="keyword">new</span> File(realFileParentPath);</span><br><span class="line">        <span class="keyword">if</span> (!dirPath.exists()) &#123;</span><br><span class="line">            dirPath.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Thumbnails.of(<span class="keyword">new</span> File(<span class="string">"F://ThumbnailsTest/lanerge.jpg"</span>)).size(<span class="number">960</span>, <span class="number">960</span>)</span><br><span class="line">                .watermark(Positions.BOTTOM_RIGHT, ImageIO.read(<span class="keyword">new</span> File(basePath + <span class="string">"/MyLogo.png"</span>)), <span class="number">0.8f</span>)</span><br><span class="line">                .outputQuality(<span class="number">0.8f</span>).toFile(<span class="string">"F://ThumbnailsTest/lanerge_fidel.jpg"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>主要修改的是修改缩略图那一块，获取文件扩展名</p>
</blockquote>
<h3 id="9-9-4修改Shop控制类"><a href="#9-9-4修改Shop控制类" class="headerlink" title="9.9.4修改Shop控制类"></a>9.9.4修改Shop控制类</h3><p><code>ShopManagementController</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.web.shopadmin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.PersonInfo;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.HttpServletRequestUtil;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.ImageUtil;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.PathUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartHttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/shopadmin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopManagementController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopService shopService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/registershop"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">registerShop</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ↓要返回给前端的一些关键键值对</span></span><br><span class="line">        Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="comment">// 1.接收并转化相应的参数，包括店铺信息以及图片信息</span></span><br><span class="line">        <span class="comment">// ↓从请求的request获取key是shopStr的变量值</span></span><br><span class="line">        String shopStr = HttpServletRequestUtil.getString(request, <span class="string">"shopStr"</span>);</span><br><span class="line">        <span class="comment">// ↓实体转换JSON需要的类</span></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        Shop shop = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ↓实体转换JSON</span></span><br><span class="line">            shop = mapper.readValue(shopStr, Shop.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// ↓如果报错了</span></span><br><span class="line">            <span class="comment">// ↓往前端返回一个‘是否成功’，值为false</span></span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">// ↓并且把失败的信息也传给前端，key是errMsg</span></span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ↓这是一个接收图片的类</span></span><br><span class="line">        CommonsMultipartFile shopImg = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// ↓文件上传解析器类，用来解析request中的文件</span></span><br><span class="line">        CommonsMultipartResolver commonsMultipartResolver = <span class="keyword">new</span> CommonsMultipartResolver(</span><br><span class="line">                <span class="comment">// ↓通过这个请求的session的上下文去解析这个request</span></span><br><span class="line">                request.getSession().getServletContext());</span><br><span class="line">        <span class="comment">// ↓判断这个request中是否有上传文件流</span></span><br><span class="line">        <span class="keyword">if</span> (commonsMultipartResolver.isMultipart(request)) &#123;</span><br><span class="line">            <span class="comment">// ↓有上传文件流，我们需将request强行转换成multipartHttpServletRequest</span></span><br><span class="line">            MultipartHttpServletRequest multipartHttpServletRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">            <span class="comment">// ↓只有将request转换为multipartHttpServletRequest，我们才能从multipartHttpServletRequest中提取图片文件流</span></span><br><span class="line">            shopImg = (CommonsMultipartFile) multipartHttpServletRequest.getFile(<span class="string">"shopImg"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ↓没有文件流，向前端报错</span></span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"上传图片不能为空"</span>);</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.注册店铺</span></span><br><span class="line">        <span class="comment">// ↓判断店铺和图片是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (shop != <span class="keyword">null</span> &amp;&amp; shopImg != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//            PersonInfo owner = (PersonInfo) request.getSession().getAttribute("user");</span></span><br><span class="line">            <span class="comment">// ↓这里应该使用session去拿取用户的，后期再改</span></span><br><span class="line">            PersonInfo owner = <span class="keyword">new</span> PersonInfo();</span><br><span class="line">            owner.setUserId(<span class="number">1L</span>);</span><br><span class="line">            shop.setOwner(owner);</span><br><span class="line">            <span class="comment">// 店铺实体类的dto扩展类</span></span><br><span class="line">            ShopExecution se = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                se = shopService.addShop(shop, shopImg.getInputStream(),shopImg.getOriginalFilename());</span><br><span class="line">                <span class="keyword">if</span> (se.getState() == ShopStateEnum.CHECK.getState()) &#123;</span><br><span class="line">                    modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                    modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ↓为空，向前端报错</span></span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"请输入店铺信息"</span>);</span><br><span class="line">            <span class="keyword">return</span> modelMap;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-9-5修改测试代码"><a href="#9-9-5修改测试代码" class="headerlink" title="9.9.5修改测试代码"></a>9.9.5修改测试代码</h3><p><code>ShopServiceTest</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.PersonInfo;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.exceptions.ShopOperationException;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopServiceTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopService shopService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddShop</span><span class="params">()</span> <span class="keyword">throws</span> ShopOperationException, FileNotFoundException </span>&#123;</span><br><span class="line">        Shop shop = <span class="keyword">new</span> Shop();</span><br><span class="line">        PersonInfo owner = <span class="keyword">new</span> PersonInfo();</span><br><span class="line">        Area area = <span class="keyword">new</span> Area();</span><br><span class="line">        ShopCategory shopCategory = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">        owner.setUserId(<span class="number">1L</span>);</span><br><span class="line">        area.setAreaId(<span class="number">3</span>);</span><br><span class="line">        shopCategory.setShopCategoryId(<span class="number">36L</span>);</span><br><span class="line">        shop.setOwner(owner);</span><br><span class="line">        shop.setArea(area);</span><br><span class="line">        shop.setShopCategory(shopCategory);</span><br><span class="line">        shop.setShopName(<span class="string">"测试的店铺4"</span>);</span><br><span class="line">        shop.setShopDesc(<span class="string">"test3"</span>);</span><br><span class="line">        shop.setShopAddr(<span class="string">"test3"</span>);</span><br><span class="line">        shop.setPhone(<span class="string">"test3"</span>);</span><br><span class="line">        shop.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        shop.setEnableStatus(ShopStateEnum.CHECK.getState());</span><br><span class="line">        shop.setAdvice(<span class="string">"审核中"</span>);</span><br><span class="line">        File shopImg = <span class="keyword">new</span> File(<span class="string">"F://ThumbnailsTest/lanerge.jpg"</span>);</span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(shopImg);</span><br><span class="line">        ShopExecution se = shopService.addShop(shop, is ,shopImg.getName());</span><br><span class="line">        assertEquals(ShopStateEnum.CHECK.getState(), se.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<h2 id="9-10店铺注册前端实现"><a href="#9-10店铺注册前端实现" class="headerlink" title="9.10店铺注册前端实现"></a>9.10店铺注册前端实现</h2><p>前端我们使用<code>sui mobile</code>来实现，它的官网：<a href="http://m.sui.taobao.org/" target="_blank" rel="noopener">http://m.sui.taobao.org/</a></p>
<p>进入官网-&gt;示例-&gt;网页调试（将页面调成移动端）-&gt;选择表单（因为我们要做一个简单店铺注册页面）-&gt;只有文案和输入框-&gt;查看源代码-&gt;复制所有html代码</p>
<h3 id="9-10-1创建index页面"><a href="#9-10-1创建index页面" class="headerlink" title="9.10.1创建index页面"></a>9.10.1创建index页面</h3><p>在<code>src\main\resources\webapp</code>下创建一个<code>index.html</code>，这里还有一个<code>index.jsp</code>。我们不用它，先不管。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SUI Mobile Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"MSUI: Build mobile apps with simple HTML, CSS, and JS components."</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">"阿里巴巴国际UED前端"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1, maximum-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"/favicon.ico"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-status-bar-style"</span> <span class="attr">content</span>=<span class="string">"black"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Google Web Fonts --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/dist/css/sm.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/dist/css/sm-extend.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/assets/css/demos.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon-precomposed"</span> <span class="attr">href</span>=<span class="string">"/assets/img/apple-touch-icon-114x114.png"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/assets/js/zepto.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/assets/js/config.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="comment">//ga</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> _hmt = _hmt || [];</span></span><br><span class="line"><span class="javascript">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> hm = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span></span><br><span class="line"><span class="javascript">    hm.src = <span class="string">"//hm.baidu.com/hm.js?ba76f8230db5f616edc89ce066670710"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="undefined">    s.parentNode.insertBefore(hm, s);</span></span><br><span class="line"><span class="undefined">&#125;)();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"page-label-input"</span> <span class="attr">class</span>=<span class="string">"page"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"bar bar-nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"button button-link button-nav pull-left back"</span> <span class="attr">href</span>=<span class="string">"/demos/form"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-left"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      返回</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>表单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-block"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Text inputs --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Your name"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>E-mail<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">placeholder</span>=<span class="string">"E-mail"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">option</span>&gt;</span>Male<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">option</span>&gt;</span>Female<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Date --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>Birth date<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">placeholder</span>=<span class="string">"Birth day"</span> <span class="attr">value</span>=<span class="string">"2014-04-30"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Switch (Checkbox) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>Switch<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label-switch"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"align-top"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>Textarea<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content-block"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-50"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"button button-big button-fill button-danger"</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-50"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"button button-big button-fill button-success"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/dist/js/sm.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/dist/js/sm-extend.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/dist/js/sm-city-picker.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/assets/js/demos.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-10-2引用静态资源"><a href="#9-10-2引用静态资源" class="headerlink" title="9.10.2引用静态资源"></a>9.10.2引用静态资源</h3><p>官网-&gt;开始使用</p>
<p>模仿完整的页面模板。覆盖掉<code>index.html</code>的<code>css</code>、<code>js</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'//g.alicdn.com/sj/lib/zepto/zepto.min.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> 启动Tomcat，访问<a href="http://localhost:8080/index.html" target="_blank" rel="noopener">http://localhost:8080/index.html</a>，生效</p>
</blockquote>
<h3 id="9-10-3修改代码"><a href="#9-10-3修改代码" class="headerlink" title="9.10.3修改代码"></a>9.10.3修改代码</h3><p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SUI Mobile Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"MSUI: Build mobile apps with simple HTML, CSS, and JS components."</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">"阿里巴巴国际UED前端"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1, maximum-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"/favicon.ico"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-status-bar-style"</span> <span class="attr">content</span>=<span class="string">"black"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//g.alicdn.com/msui/sm/0.6.2/css/sm-extend.min.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon-precomposed"</span> <span class="attr">href</span>=<span class="string">"/assets/img/apple-touch-icon-114x114.png"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//ga</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> _hmt = _hmt || [];</span></span><br><span class="line"><span class="javascript">        (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> hm = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span></span><br><span class="line"><span class="javascript">            hm.src = <span class="string">"//hm.baidu.com/hm.js?ba76f8230db5f616edc89ce066670710"</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="undefined">            s.parentNode.insertBefore(hm, s);</span></span><br><span class="line"><span class="undefined">        &#125;)();</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"page-label-input"</span> <span class="attr">class</span>=<span class="string">"page"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"bar bar-nav"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"button button-link button-nav pull-left back"</span> <span class="attr">href</span>=<span class="string">"/demos/form"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon icon-left"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                返回</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>商店信息<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list-block"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 商铺名称 text --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>商铺名称<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"shop-name"</span> <span class="attr">placeholder</span>=<span class="string">"请输入商铺名称"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 商铺分类 下拉列表 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>商铺分类<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"shop-category"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 区域分类 下拉列表 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>所属区域<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"area"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 详细地址 text --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>详细地址<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"shop-addr"</span> <span class="attr">placeholder</span>=<span class="string">"请输入详细地址"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 联系电话 text --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>联系电话<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"shop-phone"</span> <span class="attr">placeholder</span>=<span class="string">"请输入联系电话"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 缩略图 上传控件 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>缩略图<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"shop-img"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 商铺简介 textarea --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"align-top"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>商铺简介<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"shop-desc"</span> <span class="attr">placeholder</span>=<span class="string">"商铺简介"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 验证码 kaptcha --&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content-block"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-50"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"button button-big button-fill button-danger"</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-50"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"button button-big button-fill button-success"</span> <span class="attr">id</span>=<span class="string">"submit"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'//g.alicdn.com/sj/lib/zepto/zepto.min.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>运行，界面修改成功</p>
</blockquote>
<h3 id="9-10-4静态资源调整"><a href="#9-10-4静态资源调整" class="headerlink" title="9.10.4静态资源调整"></a>9.10.4静态资源调整</h3><p>为了不让浏览器直接输入项目内容访问指定的页面，我们需要进行优化</p>
<ol>
<li>在<code>WEB-INF</code>下创建一个<code>html</code>文件夹，这个文件夹外部是访问不了的</li>
<li>在<code>html</code>文件夹下创建一个<code>shop</code>文件夹，用来专门存放店铺的静态资源</li>
<li>向上面的<code>index.html</code>重命名为<code>shopoperation.html</code>，放到<code>shop</code>文件夹下。</li>
<li>现在访问不了这个文件了，所以我们要使用后台的路由，将访问导过去。</li>
</ol>
<h3 id="9-10-5后端路由导向"><a href="#9-10-5后端路由导向" class="headerlink" title="9.10.5后端路由导向"></a>9.10.5后端路由导向</h3><p>在<code>src\main\java\web\shopadmin</code>下创建<code>ShopAdminController.java</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.web.shopadmin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">// ↓当响应这个路由时，重定向</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"shopadmin"</span>, method = &#123;RequestMethod.GET&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAdminController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ↓做转发操作</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/shopoperation"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">shopOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"shop/shopoperation"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里之所以没有前缀<code>/WEB-INF/html/</code>，和后缀<code>.html</code>，是因为在<code>src\main\resources\spring\spring-web.xml</code>中配置了前缀和后缀</p>
</blockquote>
<p>运行Tomcat访问<code>&lt;http://localhost:8080/shopadmin/shopoperation/&gt;</code>，访问成功。</p>
<h3 id="9-10-6创建JS文件"><a href="#9-10-6创建JS文件" class="headerlink" title="9.10.6创建JS文件"></a>9.10.6创建JS文件</h3><p>在<code>src\main\resources\webapp\resources</code>下创建<code>js</code>文件夹</p>
<p>再<code>js</code>下创建一个<code>shop</code>用来专门存储店铺的<code>js</code>文件</p>
<blockquote>
<p><code>js</code>文件主要是操作html页面的，获取初始信息，提交按钮收集信息，通过<code>ajax</code>发送到后台</p>
</blockquote>
<p>在<code>shop</code>文件夹下创建<code>shopoperation.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 用于店铺注册时候的店铺类别以及区域列表的初始化的URL</span></span><br><span class="line">    <span class="keyword">var</span> initUrl = <span class="string">'/shopadmin/getshopinitinfo'</span>;</span><br><span class="line">    <span class="comment">// 注册店铺的URL</span></span><br><span class="line">    <span class="keyword">var</span> registerShopUrl = <span class="string">'/shopadmin/registershop'</span>;</span><br><span class="line">    <span class="comment">// 加载方法执行</span></span><br><span class="line">    getShopInitInfo();</span><br><span class="line">    <span class="comment">// 取得所有二级店铺类别以及区域信息，并分别赋值进类别列表以及区域列表</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getShopInitInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 发送一个异步请求，第一个参数访问地址，第二个参数回调函数</span></span><br><span class="line">        $.getJSON(initUrl, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// ↓访问成功</span></span><br><span class="line">            <span class="keyword">if</span> (data.success) &#123;</span><br><span class="line">                <span class="comment">// ↓初始化保存店铺分类的html文本</span></span><br><span class="line">                <span class="keyword">var</span> tempHtml = <span class="string">''</span>;</span><br><span class="line">                <span class="comment">// ↓初始化保存区域分类的html文本</span></span><br><span class="line">                <span class="keyword">var</span> tempAreaHtml = <span class="string">''</span>;</span><br><span class="line">                <span class="comment">// ↓赋值店铺分类html文本</span></span><br><span class="line">                <span class="comment">// ↓shopCategoryList是返回的data数据里面的一项，由后端负责</span></span><br><span class="line">                <span class="comment">// ↓以下是ES6语法，直接使用map方法将键值对的内容赋值给tempHtml</span></span><br><span class="line">                data.shopCategoryList.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">                    tempHtml += <span class="string">'&lt;option data-id="'</span> + item.shopCategoryId</span><br><span class="line">                        + <span class="string">'"&gt;'</span> + item.shopCategoryName + <span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// ↓同上</span></span><br><span class="line">                data.areaList.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">                    tempAreaHtml += <span class="string">'&lt;option data-id="'</span> + item.areaId + <span class="string">'"&gt;'</span></span><br><span class="line">                        + item.areaName + <span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// ↓重写id为shop-category的DOM元素的html内容</span></span><br><span class="line">                $(<span class="string">'#shop-category'</span>).html(tempHtml);</span><br><span class="line">                <span class="comment">// ↓同上</span></span><br><span class="line">                $(<span class="string">'#area'</span>).html(tempAreaHtml);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提交按钮的事件响应，分别对店铺注册和编辑操作做不同响应</span></span><br><span class="line">    $(<span class="string">'#submit'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 创建shop对象</span></span><br><span class="line">        <span class="keyword">var</span> shop = &#123;&#125;;</span><br><span class="line">        <span class="comment">// 获取表单里的数据并填充进对应的店铺属性中</span></span><br><span class="line">        shop.shopName = $(<span class="string">'#shop-name'</span>).val();</span><br><span class="line">        shop.shopAddr = $(<span class="string">'#shop-addr'</span>).val();</span><br><span class="line">        shop.phone = $(<span class="string">'#shop-phone'</span>).val();</span><br><span class="line">        shop.shopDesc = $(<span class="string">'#shop-desc'</span>).val();</span><br><span class="line">        <span class="comment">// 选择选定好的店铺类别</span></span><br><span class="line">        shop.shopCategory = &#123;</span><br><span class="line">            shopCategoryId: $(<span class="string">'#shop-category'</span>).find(<span class="string">'option'</span>).not(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="keyword">this</span>.selected;</span><br><span class="line">            &#125;).data(<span class="string">'id'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 选择选定好的区域信息</span></span><br><span class="line">        shop.area = &#123;</span><br><span class="line">            areaId: $(<span class="string">'#area'</span>).find(<span class="string">'option'</span>).not(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="keyword">this</span>.selected;</span><br><span class="line">            &#125;).data(<span class="string">'id'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 获取上传的图片文件流</span></span><br><span class="line">        <span class="keyword">var</span> shopImg = $(<span class="string">'#shop-img'</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 生成表单对象，用于接收参数并传递给后台</span></span><br><span class="line">        <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">        <span class="comment">// 添加图片流进表单对象里</span></span><br><span class="line">        formData.append(<span class="string">'shopImg'</span>, shopImg);</span><br><span class="line">        <span class="comment">// 将shop json对象转成字符流保存至表单对象key为shopStr的的键值对里</span></span><br><span class="line">        formData.append(<span class="string">'shopStr'</span>, <span class="built_in">JSON</span>.stringify(shop));</span><br><span class="line">        <span class="comment">// 将数据提交至后台处理相关操作</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: registerShopUrl,</span><br><span class="line">            type: <span class="string">'POST'</span>,</span><br><span class="line">            data: formData,</span><br><span class="line">            contentType: <span class="literal">false</span>,</span><br><span class="line">            processData: <span class="literal">false</span>,</span><br><span class="line">            cache: <span class="literal">false</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (data.success) &#123;</span><br><span class="line">                    $.toast(<span class="string">'提交成功！'</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $.toast(<span class="string">'提交失败！'</span> + data.errMsg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="9-10-7后端响应JS方法"><a href="#9-10-7后端响应JS方法" class="headerlink" title="9.10.7后端响应JS方法"></a>9.10.7后端响应JS方法</h3><p>之前的<code>Dao</code>层已经实现了<code>AreaDao</code>的List方法</p>
<p>现在实现<code>ShopCategoryDao</code>接口</p>
<p>在<code>src\main\java\dao</code>层添加<code>ShopCategoryDao.java</code>接口</p>
<p><strong>Dao接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShopCategoryDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据传入的查询条件返回店铺类别列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shopCategoryCondition</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;ShopCategory&gt; <span class="title">queryShopCategory</span><span class="params">(@Param(<span class="string">"shopCategoryCondition"</span>)</span> ShopCategory shopCategoryCondition)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Mybatis文件</strong></p>
<p>对应的在<code>src\main\resources\mapper</code>文件夹下创建<code>ShopCategoryDao.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xiaoxin.o2o.dao.ShopCategoryDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryShopCategory"</span> <span class="attr">resultType</span>=<span class="string">"com.xiaoxin.o2o.entity.ShopCategory"</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">        shop_category_id,</span><br><span class="line">        shop_category_name,</span><br><span class="line">        shop_category_desc,</span><br><span class="line">        shop_category_img,</span><br><span class="line">        priority,</span><br><span class="line">        create_time,</span><br><span class="line">        last_edit_time,</span><br><span class="line">        parent_id</span><br><span class="line">        FROM</span><br><span class="line">        tb_shop_category</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCategoryCondition.parent != null"</span>&gt;</span></span><br><span class="line">                and parent_id = #&#123;shopCategoryCondition.parent.shopCategoryId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        ORDER BY</span><br><span class="line">        priority DESC</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>测试</strong></p>
<p>在<code>test\java\dao</code>层创建<code>ShopCategoryDaoTest</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCategoryDaoTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopCategoryDao shopCategoryDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryShopCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;ShopCategory&gt; shopCategoryList = shopCategoryDao.queryShopCategory(<span class="keyword">new</span> ShopCategory());</span><br><span class="line">        System.out.println(shopCategoryList.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ↓测试特定类别ID下的类别</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryShopCategoryParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ShopCategory testCategory = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">        ShopCategory parentCategory = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">        parentCategory.setShopCategoryId(<span class="number">36L</span>);</span><br><span class="line">        testCategory.setParent(parentCategory);</span><br><span class="line">        <span class="comment">// ↓查找所有parentId是36的类别</span></span><br><span class="line">        List&lt;ShopCategory&gt; shopCategoryList = shopCategoryDao.queryShopCategory(testCategory);</span><br><span class="line">        System.out.println(shopCategoryList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<p><strong>Service层</strong></p>
<p><code>ShopCategoryService</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ShopCategoryService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据查询条件获取ShopCategory列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shopCategoryCondition</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;ShopCategory&gt; <span class="title">getShopCategoryList</span><span class="params">(ShopCategory shopCategoryCondition)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ShopCategoryServiceImpl</code>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dao.ShopCategoryDao;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopCategoryService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCategoryServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopCategoryService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopCategoryDao shopCategoryDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopCategory&gt; <span class="title">getShopCategoryList</span><span class="params">(ShopCategory shopCategory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopCategoryDao.queryShopCategory(shopCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Controller层</strong></p>
<p>修改<code>ShopManagementController</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.web.shopadmin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.dto.ShopExecution;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Area;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.PersonInfo;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.entity.ShopCategory;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.enums.ShopStateEnum;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.AreaService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopCategoryService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.service.ShopService;</span><br><span class="line"><span class="keyword">import</span> com.xiaoxin.o2o.util.HttpServletRequestUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartHttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.commons.CommonsMultipartResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/shopadmin"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopManagementController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopService shopService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ShopCategoryService shopCategoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AreaService areaService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getshopinitinfo"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">getShopInitInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        List&lt;ShopCategory&gt; shopCategoryList = <span class="keyword">new</span> ArrayList&lt;ShopCategory&gt;();</span><br><span class="line">        List&lt;Area&gt; areaList = <span class="keyword">new</span> ArrayList&lt;Area&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            shopCategoryList = shopCategoryService.getShopCategoryList(<span class="keyword">new</span> ShopCategory());</span><br><span class="line">            areaList = areaService.getAreaList();</span><br><span class="line">            modelMap.put(<span class="string">"shopCategoryList"</span>, shopCategoryList);</span><br><span class="line">            modelMap.put(<span class="string">"areaList"</span>, areaList);</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 之前创建店铺的方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-10-8修改店铺类别Mybatis"><a href="#9-10-8修改店铺类别Mybatis" class="headerlink" title="9.10.8修改店铺类别Mybatis"></a>9.10.8修改店铺类别Mybatis</h3><p>因为我们的店铺都存储在2级店铺类别底下，即1级类别是吃喝拉撒睡，而2级类别是吃里面的炒酸奶。店铺的创建选择的店铺类别就是选择这个炒酸奶这一级的店铺类别。</p>
<p>所以我们注册店铺获取的店铺类别List要在Mybatis中做一点修改</p>
<p>在<code>where</code>中添加一个条件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCategoryCondition == null"</span>&gt;</span></span><br><span class="line">    and parent_id is null</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCategoryCondition != null"</span>&gt;</span></span><br><span class="line">    and parent_id is not null</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样我们在获取店铺类别的时候，传入一个默认的<code>shopCategoryCondition</code>就可以获得所有二级类别</p>
<blockquote>
<p>OK,启动Tomcat，访问刚刚的页面，测试成功！</p>
</blockquote>
<h2 id="9-11添加验证码"><a href="#9-11添加验证码" class="headerlink" title="9.11添加验证码"></a>9.11添加验证码</h2><p>依赖包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-11-1web-xml配置"><a href="#9-11-1web-xml配置" class="headerlink" title="9.11.1web.xml配置"></a>9.11.1web.xml配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/spring-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 是否有边框 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.border<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>no<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 字体颜色 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.font.color<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>red<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 图片宽度 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.image.width<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>135<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用哪些字符生成验证码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.char.string<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>ACDEFHKPRSTWX345679<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 图片高度 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.image.height<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>50<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 字体大小 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.font.size<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>43<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 干扰线的颜色 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.noise.color<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>black<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 字符个数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.char.length<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 字体 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.textproducer.font.names<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Arial<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Kaptcha<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring-dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 默认匹配所有的请求 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-11-2修改shopoperation-html"><a href="#9-11-2修改shopoperation-html" class="headerlink" title="9.11.2修改shopoperation.html"></a>9.11.2修改shopoperation.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-inner"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-title label"</span>&gt;</span>验证码<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"j_captcha"</span> <span class="attr">placeholder</span>=<span class="string">"验证码"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item-input"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"captcha_img"</span> <span class="attr">alt</span>=<span class="string">"点击更换"</span> <span class="attr">title</span>=<span class="string">"点击更换"</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">onclick</span>=<span class="string">"changeVerifyCode(this)"</span> <span class="attr">src</span>=<span class="string">"../Kaptcha"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>changeVerifyCode函数在js中定义</p>
</blockquote>
<h3 id="9-11-3添加js"><a href="#9-11-3添加js" class="headerlink" title="9.11.3添加js"></a>9.11.3添加js</h3><p>因为这个验证码要在其他地方也要使用，所以这里把这个功能的js放到一个<code>common</code>包中</p>
<p>在<code>src\main\resources\webapp\resources\js\common</code>包中创建<code>common.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeVerifyCode</span>(<span class="params">img</span>) </span>&#123;</span><br><span class="line">    img.src = <span class="string">"../Kaptcha?"</span> + <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-11-4修改提交js"><a href="#9-11-4修改提交js" class="headerlink" title="9.11.4修改提交js"></a>9.11.4修改提交js</h3><p>修改<code>shopoperation.js</code>中提交部分的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取表单里输入的验证码</span></span><br><span class="line"><span class="keyword">var</span> verifyCodeActual = $(<span class="string">'#j_captcha'</span>).val();</span><br><span class="line"><span class="keyword">if</span> (!verifyCodeActual) &#123;</span><br><span class="line">    $.toast(<span class="string">'请输入验证码！'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">formData.append(<span class="string">'verifyCodeActual'</span>, verifyCodeActual);</span><br><span class="line"><span class="comment">// 将数据提交至后台处理相关操作</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: registerShopUrl,</span><br><span class="line">    type: <span class="string">'POST'</span>,</span><br><span class="line">    data: formData,</span><br><span class="line">    contentType: <span class="literal">false</span>,</span><br><span class="line">    processData: <span class="literal">false</span>,</span><br><span class="line">    cache: <span class="literal">false</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data.success) &#123;</span><br><span class="line">            $.toast(<span class="string">'提交成功！'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $.toast(<span class="string">'提交失败！'</span> + data.errMsg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 点击验证码图片的时候，注册码会改变</span></span><br><span class="line">        $(<span class="string">'#captcha_img'</span>).click();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="9-11-5页面引入JS"><a href="#9-11-5页面引入JS" class="headerlink" title="9.11.5页面引入JS"></a>9.11.5页面引入JS</h3><p>在<code>shopoperation.html</code>中引入<code>common.js</code>文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'/resources/js/common/common.js'</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="9-11-6响应验证码后端"><a href="#9-11-6响应验证码后端" class="headerlink" title="9.11.6响应验证码后端"></a>9.11.6响应验证码后端</h3><p>在<code>util</code>包中添加<code>CodeUtil.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查验证码是否和预期相符</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkVerifyCode</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String verifyCodeExpected = (String) request.getSession()</span><br><span class="line">                .getAttribute(com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">        String verifyCodeActual = HttpServletRequestUtil.getString(request, <span class="string">"verifyCodeActual"</span>);</span><br><span class="line">        <span class="keyword">if</span> (verifyCodeActual == <span class="keyword">null</span> || !verifyCodeActual.equals(verifyCodeExpected)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改提交按钮响应的后端方法，在里面调用这个工具类验证验证码</p>
<p><code>ShopManagementController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/registershop"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">registerShop</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓要返回给前端的一些关键键值对</span></span><br><span class="line">    Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    <span class="keyword">if</span> (!CodeUtil.checkVerifyCode(request)) &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"输入了错误的验证码"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-11-7DeBug测试"><a href="#9-11-7DeBug测试" class="headerlink" title="9.11.7DeBug测试"></a>9.11.7DeBug测试</h3><p>测试没有反应</p>
<ol>
<li><p>修改<code>spring-web.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置SpringMVC --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.开启SpringMVC注解模式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2.静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用"/"做整体映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/resources/**"</span> <span class="attr">location</span>=<span class="string">"/resources/"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.定义视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/html/"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".html"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 文件上传解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1024 * 1024 * 20 = 20M --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"20971520"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxInMemorySize"</span> <span class="attr">value</span>=<span class="string">"20971520"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4.扫描web相关的bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xiaoxin.o2o.web"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>里面主要添加了文件上传解析器</p>
</blockquote>
<p>2.修改<code>pom.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>o2o<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>插件这一块，统一版本</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>整体测试成功</p>
</blockquote>
<h2 id="9-12店铺信息修改"><a href="#9-12店铺信息修改" class="headerlink" title="9.12店铺信息修改"></a>9.12店铺信息修改</h2><h3 id="9-12-1店铺信息获取"><a href="#9-12-1店铺信息获取" class="headerlink" title="9.12.1店铺信息获取"></a>9.12.1店铺信息获取</h3><p>因为在修改店铺得信息时，我们要先获取原来店铺得信息，从而才能修改店铺信息。</p>
<p><strong>Dao层</strong></p>
<p>在<code>ShopDao.java</code>中添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过shop id 查询店铺</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shopId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> shop</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Shop <span class="title">queryByShopId</span><span class="params">(<span class="keyword">long</span> shopId)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>Mybatis文件</strong></p>
<p><code>ShopDao.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.xiaoxin.o2o.dao.ShopDao"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.xiaoxin.o2o.entity.Shop"</span> <span class="attr">id</span>=<span class="string">"shopMap"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--主键ID--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"shop_id"</span> <span class="attr">property</span>=<span class="string">"shopId"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"shop_name"</span> <span class="attr">property</span>=<span class="string">"shopName"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"shop_desc"</span> <span class="attr">property</span>=<span class="string">"shopDesc"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"shop_addr"</span> <span class="attr">property</span>=<span class="string">"shopAddr"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"phone"</span> <span class="attr">property</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"shop_img"</span> <span class="attr">property</span>=<span class="string">"shopImg"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"priority"</span> <span class="attr">property</span>=<span class="string">"priority"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"create_time"</span> <span class="attr">property</span>=<span class="string">"createTime"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"last_edit_time"</span> <span class="attr">property</span>=<span class="string">"lastEditTime"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"enable_status"</span> <span class="attr">property</span>=<span class="string">"enableStatus"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"advice"</span> <span class="attr">property</span>=<span class="string">"advice"</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--复合类型--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"area"</span> <span class="attr">column</span>=<span class="string">"area_id"</span></span></span><br><span class="line"><span class="tag">					 <span class="attr">javaType</span>=<span class="string">"com.xiaoxin.o2o.entity.Area"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"area_id"</span> <span class="attr">property</span>=<span class="string">"areaId"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"area_name"</span> <span class="attr">property</span>=<span class="string">"areaName"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"shopCategory"</span> <span class="attr">column</span>=<span class="string">"shop_category_id"</span></span></span><br><span class="line"><span class="tag">					 <span class="attr">javaType</span>=<span class="string">"com.xiaoxin.o2o.entity.ShopCategory"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"shop_category_id"</span> <span class="attr">property</span>=<span class="string">"shopCategoryId"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"shop_category_name"</span> <span class="attr">property</span>=<span class="string">"shopCategoryName"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"owner"</span> <span class="attr">column</span>=<span class="string">"user_id"</span></span></span><br><span class="line"><span class="tag">					 <span class="attr">javaType</span>=<span class="string">"com.xiaoxin.o2o.entity.PersonInfo"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"userId"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryByShopId"</span> <span class="attr">resultMap</span>=<span class="string">"shopMap"</span> <span class="attr">parameterType</span>=<span class="string">"Long"</span>&gt;</span></span><br><span class="line">		SELECT</span><br><span class="line">		s.shop_id,</span><br><span class="line">		s.shop_name,</span><br><span class="line">		s.shop_desc,</span><br><span class="line">		s.shop_addr,</span><br><span class="line">		s.phone,</span><br><span class="line">		s.shop_img,</span><br><span class="line">		s.priority,</span><br><span class="line">		s.create_time,</span><br><span class="line">		s.last_edit_time,</span><br><span class="line">		s.enable_status,</span><br><span class="line">		s.advice,</span><br><span class="line">		a.area_id,</span><br><span class="line">		a.area_name,</span><br><span class="line">		sc.shop_category_id,</span><br><span class="line">		sc.shop_category_name</span><br><span class="line">		FROM</span><br><span class="line">		tb_shop s,</span><br><span class="line">		tb_area a,</span><br><span class="line">		tb_shop_category sc</span><br><span class="line">		WHERE</span><br><span class="line">		s.area_id=a.area_id</span><br><span class="line">		AND</span><br><span class="line">		s.shop_category_id = sc.shop_category_id</span><br><span class="line">		AND</span><br><span class="line">		s.shop_id = #&#123;shopId&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 之前的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>测试Dao层</strong></p>
<p>在<code>ShopDaoTest</code>里面添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryByShopId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> shopId = <span class="number">36</span>;</span><br><span class="line">    Shop shop = shopDao.queryByShopId(shopId);</span><br><span class="line">    System.out.println(<span class="string">"areaId:"</span> + shop.getArea().getAreaId());</span><br><span class="line">    System.out.println(<span class="string">"areaName"</span> + shop.getArea().getAreaName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<p><strong>Service层</strong></p>
<p><code>ShopService</code>层添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过店铺Id获取店铺信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shopId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Shop <span class="title">getByShopId</span><span class="params">(<span class="keyword">long</span> shopId)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新店铺信息，包括对图片的处理</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shop</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shopImgInputStream</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ShopOperationException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ShopExecution <span class="title">modifyShop</span><span class="params">(Shop shop, InputStream shopImgInputStream, String fileName)</span> <span class="keyword">throws</span> ShopOperationException</span>;</span><br></pre></td></tr></table></figure>
<p><strong>工具类</strong></p>
<p>因为这里要考虑到删除原来的图片所以要添加应该删除图片的工具类</p>
<p><code>ImgageUtil</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * storePath是文件的路径还是目录的路径， 如果storePath是文件路径则删除该文件，</span></span><br><span class="line"><span class="comment"> * 如果storePath是目录路径则删除该目录下的所有文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> storePath</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteFileOrPath</span><span class="params">(String storePath)</span> </span>&#123;</span><br><span class="line">    File fileOrPath = <span class="keyword">new</span> File(PathUtil.getImgBasePath() + storePath);</span><br><span class="line">    <span class="comment">// ↓判断这个路径下这个文件是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (fileOrPath.exists()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileOrPath.isDirectory()) &#123;</span><br><span class="line">            <span class="comment">// ↓如果这个文件是文件夹，删除所有</span></span><br><span class="line">            File files[] = fileOrPath.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">                files[i].delete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果是文件，直接删除</span></span><br><span class="line">        fileOrPath.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Service层实现类</strong></p>
<p><code>ShopServiceImpl</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Shop <span class="title">getByShopId</span><span class="params">(<span class="keyword">long</span> shopId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> shopDao.queryByShopId(shopId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShopExecution <span class="title">modifyShop</span><span class="params">(Shop shop, InputStream shopImgInputStream, String fileName)</span> <span class="keyword">throws</span> ShopOperationException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (shop == <span class="keyword">null</span> || shop.getShopId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.NULL_SHOP);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 1.判断是否需要处理图片</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (shopImgInputStream != <span class="keyword">null</span> &amp;&amp; fileName != <span class="keyword">null</span> &amp;&amp; !<span class="string">""</span>.equals(fileName)) &#123;</span><br><span class="line">                Shop tempShop = shopDao.queryByShopId(shop.getShopId());</span><br><span class="line">                <span class="keyword">if</span> (tempShop.getShopImg() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    ImageUtil.deleteFileOrPath(tempShop.getShopImg());</span><br><span class="line">                &#125;</span><br><span class="line">                addShopImg(shop, shopImgInputStream, fileName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 2.更新店铺信息</span></span><br><span class="line">            shop.setLastEditTime(<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="keyword">int</span> effectedNum = shopDao.updateShop(shop);</span><br><span class="line">            <span class="keyword">if</span> (effectedNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.INNER_ERROR);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                shop = shopDao.queryByShopId(shop.getShopId());</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ShopExecution(ShopStateEnum.SUCCESS, shop);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ShopOperationException(<span class="string">"modifyShop error:"</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Service层测试</strong></p>
<p>在<code>ShopServiceTest</code>测试类中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testModifyShop</span><span class="params">()</span> <span class="keyword">throws</span> ShopOperationException, FileNotFoundException </span>&#123;</span><br><span class="line">    Shop shop = <span class="keyword">new</span> Shop();</span><br><span class="line">    shop.setShopId(<span class="number">43L</span>);</span><br><span class="line">    shop.setShopName(<span class="string">"修改后的店铺名称"</span>);</span><br><span class="line">    File shopImg = <span class="keyword">new</span> File(<span class="string">"F://ThumbnailsTest/labgege.jpg"</span>);</span><br><span class="line">    InputStream is = <span class="keyword">new</span> FileInputStream(shopImg);</span><br><span class="line">    ShopExecution shopExecution = shopService.modifyShop(shop, is , <span class="string">"labgege.jpg"</span>);</span><br><span class="line">    System.out.println(<span class="string">"新的图片地址为："</span> + shopExecution.getShop().getShopImg());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<p><strong>Controller层</strong></p>
<p><code>ShopManagementController</code>类修改注册<code>Session</code>相关改动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/registershop"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">registerShop</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ↓要返回给前端的一些关键键值对</span></span><br><span class="line">    Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    <span class="keyword">if</span> (!CodeUtil.checkVerifyCode(request)) &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"输入了错误的验证码"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.接收并转化相应的参数，包括店铺信息以及图片信息</span></span><br><span class="line">    <span class="comment">// ↓从请求的request获取key是shopStr的变量值</span></span><br><span class="line">    String shopStr = HttpServletRequestUtil.getString(request, <span class="string">"shopStr"</span>);</span><br><span class="line">    <span class="comment">// ↓实体转换JSON需要的类</span></span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    Shop shop = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ↓实体转换JSON</span></span><br><span class="line">        shop = mapper.readValue(shopStr, Shop.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">// ↓如果报错了</span></span><br><span class="line">        <span class="comment">// ↓往前端返回一个‘是否成功’，值为false</span></span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// ↓并且把失败的信息也传给前端，key是errMsg</span></span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ↓这是一个接收图片的类</span></span><br><span class="line">    CommonsMultipartFile shopImg = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// ↓文件上传解析器类，用来解析request中的文件</span></span><br><span class="line">    CommonsMultipartResolver commonsMultipartResolver = <span class="keyword">new</span> CommonsMultipartResolver(</span><br><span class="line">        <span class="comment">// ↓通过这个请求的session的上下文去解析这个request</span></span><br><span class="line">        request.getSession().getServletContext());</span><br><span class="line">    <span class="comment">// ↓判断这个request中是否有上传文件流</span></span><br><span class="line">    <span class="keyword">if</span> (commonsMultipartResolver.isMultipart(request)) &#123;</span><br><span class="line">        <span class="comment">// ↓有上传文件流，我们需将request强行转换成multipartHttpServletRequest</span></span><br><span class="line">        MultipartHttpServletRequest multipartHttpServletRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">        <span class="comment">// ↓只有将request转换为multipartHttpServletRequest，我们才能从multipartHttpServletRequest中提取图片文件流</span></span><br><span class="line">        shopImg = (CommonsMultipartFile) multipartHttpServletRequest.getFile(<span class="string">"shopImg"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ↓没有文件流，向前端报错</span></span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"上传图片不能为空"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.注册店铺</span></span><br><span class="line">    <span class="comment">// ↓判断店铺和图片是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (shop != <span class="keyword">null</span> &amp;&amp; shopImg != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//            PersonInfo owner = (PersonInfo) request.getSession().getAttribute("user");</span></span><br><span class="line">        <span class="comment">// ↓这里应该使用session去拿取用户的，后期再改</span></span><br><span class="line">        PersonInfo owner = (PersonInfo) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        shop.setOwner(owner);</span><br><span class="line">        <span class="comment">// 店铺实体类的dto扩展类</span></span><br><span class="line">        ShopExecution se = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            se = shopService.addShop(shop, shopImg.getInputStream(), shopImg.getOriginalFilename());</span><br><span class="line">            <span class="keyword">if</span> (se.getState() == ShopStateEnum.CHECK.getState()) &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">                <span class="comment">// ↓因为用户和店铺是一对多的，所以要创建应该session来存储店铺列表</span></span><br><span class="line">                <span class="comment">// ↓去除警告信息</span></span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                List&lt;Shop&gt; shopList = (List&lt;Shop&gt;) request.getSession().getAttribute(<span class="string">"shopList"</span>);</span><br><span class="line">                <span class="comment">// 如果是这个用户第一个创建的店铺</span></span><br><span class="line">                <span class="keyword">if</span> (shopList == <span class="keyword">null</span> || shopList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                    shopList = <span class="keyword">new</span> ArrayList&lt;Shop&gt;();</span><br><span class="line">                &#125;</span><br><span class="line">                shopList.add(se.getShop());</span><br><span class="line">                request.getSession().setAttribute(<span class="string">"shopList"</span>, shopList);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ↓为空，向前端报错</span></span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"请输入店铺信息"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加两个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/getshopbyid"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">getShopById</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    Long shopId = HttpServletRequestUtil.getLong(request, <span class="string">"shopId"</span>);</span><br><span class="line">    <span class="keyword">if</span> (shopId &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Shop shop = shopService.getByShopId(shopId);</span><br><span class="line">            List&lt;Area&gt; areaList = areaService.getAreaList();</span><br><span class="line">            modelMap.put(<span class="string">"shop"</span>, shop);</span><br><span class="line">            modelMap.put(<span class="string">"areaList"</span>, areaList);</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"empty shopId"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modelMap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/modifyshop"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">modifyShop</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    <span class="keyword">if</span> (!CodeUtil.checkVerifyCode(request)) &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"输入了错误的验证码"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.接收并转化相应的参数，包括店铺信息以及图片信息</span></span><br><span class="line">    String shopStr = HttpServletRequestUtil.getString(request, <span class="string">"shopStr"</span>);</span><br><span class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    Shop shop = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        shop = mapper.readValue(shopStr, Shop.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">    CommonsMultipartFile shopImg = <span class="keyword">null</span>;</span><br><span class="line">    CommonsMultipartResolver commonsMultipartResolver = <span class="keyword">new</span> CommonsMultipartResolver(</span><br><span class="line">        request.getSession().getServletContext());</span><br><span class="line">    <span class="keyword">if</span> (commonsMultipartResolver.isMultipart(request)) &#123;</span><br><span class="line">        MultipartHttpServletRequest multipartHttpServletRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">        shopImg = (CommonsMultipartFile) multipartHttpServletRequest.getFile(<span class="string">"shopImg"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.修改店铺信息</span></span><br><span class="line">    <span class="keyword">if</span> (shop != <span class="keyword">null</span> &amp;&amp; shop.getShopId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 店铺实体类的dto扩展类</span></span><br><span class="line">        ShopExecution se = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (shopImg == <span class="keyword">null</span>)&#123;</span><br><span class="line">                se = shopService.modifyShop(shop, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                se = shopService.modifyShop(shop, shopImg.getInputStream(), shopImg.getOriginalFilename());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (se.getState() == ShopStateEnum.SUCCESS.getState()) &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">                modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">            modelMap.put(<span class="string">"errMsg"</span>, se.getStateInfo());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, <span class="string">"请输入店铺Id"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>启动Tomcat访问<code>&lt;http://localhost:8080/shopadmin/getshopbyid?shopId=43&gt;</code>，测试成功</p>
</blockquote>
<h3 id="9-12-2前端实现"><a href="#9-12-2前端实现" class="headerlink" title="9.12.2前端实现"></a>9.12.2前端实现</h3><p>现在<code>common.js</code>中添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	组织正则表达式，主要是定位name所在的位置，并截取name=value</span></span><br><span class="line"><span class="comment"> *	如www.baidu.com:8080?a=1&amp;b=2&amp;c=3</span></span><br><span class="line"><span class="comment"> *	若传入b，则获取b=2，并经过后续步骤拆解成2返回</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getQueryString</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|&amp;)"</span> + name + <span class="string">"=([^&amp;]*)(&amp;|$)"</span>);</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">window</span>.location.search.substr(<span class="number">1</span>).match(reg);</span><br><span class="line">    <span class="keyword">if</span> (r != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(r[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改之前的<code>shopoperation.js</code>文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 从URL里获取shopId参数的值</span></span><br><span class="line">    <span class="keyword">var</span> shopId = getQueryString(<span class="string">'shopId'</span>);</span><br><span class="line">    <span class="comment">// 由于店铺注册和编辑使用的是同一个页面，</span></span><br><span class="line">    <span class="comment">// 该标识符用来标明本次是添加还是编辑操作</span></span><br><span class="line">    <span class="keyword">var</span> isEdit = shopId ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 用于店铺注册时候的店铺类别以及区域列表的初始化的URL</span></span><br><span class="line">    <span class="keyword">var</span> initUrl = <span class="string">'/shopadmin/getshopinitinfo'</span>;</span><br><span class="line">    <span class="comment">// 注册店铺的URL</span></span><br><span class="line">    <span class="keyword">var</span> registerShopUrl = <span class="string">'/shopadmin/registershop'</span>;</span><br><span class="line">    <span class="comment">// 编辑店铺前需要获取店铺信息，这里为获取当前店铺信息的URL</span></span><br><span class="line">    <span class="keyword">var</span> shopInfoUrl = <span class="string">"/shopadmin/getshopbyid?shopId="</span> + shopId;</span><br><span class="line">    <span class="comment">// 编辑店铺信息的URL</span></span><br><span class="line">    <span class="keyword">var</span> editShopUrl = <span class="string">'/shopadmin/modifyshop'</span>;</span><br><span class="line">    <span class="comment">// 判断是编辑操作还是注册操作</span></span><br><span class="line">    <span class="keyword">if</span> (!isEdit) &#123;</span><br><span class="line">        getShopInitInfo();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        getShopInfo(shopId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过店铺Id获取店铺信息</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getShopInfo</span>(<span class="params">shopId</span>) </span>&#123;</span><br><span class="line">        $.getJSON(shopInfoUrl, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (data.success) &#123;</span><br><span class="line">                <span class="comment">// 若访问成功，则依据后台传递过来的店铺信息为表单元素赋值</span></span><br><span class="line">                <span class="keyword">var</span> shop = data.shop;</span><br><span class="line">                $(<span class="string">'#shop-name'</span>).val(shop.shopName);</span><br><span class="line">                $(<span class="string">'#shop-addr'</span>).val(shop.shopAddr);</span><br><span class="line">                $(<span class="string">'#shop-phone'</span>).val(shop.phone);</span><br><span class="line">                $(<span class="string">'#shop-desc'</span>).val(shop.shopDesc);</span><br><span class="line">                <span class="comment">// 给店铺类别选定原先的店铺类别值</span></span><br><span class="line">                <span class="keyword">var</span> shopCategory = <span class="string">'&lt;option data-id="'</span></span><br><span class="line">                    + shop.shopCategory.shopCategoryId + <span class="string">'" selected&gt;'</span></span><br><span class="line">                    + shop.shopCategory.shopCategoryName + <span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">                <span class="keyword">var</span> tempAreaHtml = <span class="string">''</span>;</span><br><span class="line">                <span class="comment">// 初始化区域列表</span></span><br><span class="line">                data.areaList.map(<span class="function"><span class="keyword">function</span>(<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">                    tempAreaHtml += <span class="string">'&lt;option data-id="'</span> + item.areaId + <span class="string">'"&gt;'</span></span><br><span class="line">                        + item.areaName + <span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                $(<span class="string">'#shop-category'</span>).html(shopCategory);</span><br><span class="line">                <span class="comment">// 不允许选择店铺类别</span></span><br><span class="line">                $(<span class="string">'#shop-category'</span>).attr(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);</span><br><span class="line">                $(<span class="string">'#area'</span>).html(tempAreaHtml);</span><br><span class="line">                <span class="comment">// 给店铺选定原先的所属的区域</span></span><br><span class="line">                $(<span class="string">"#area option[data-id='"</span> + shop.area.areaId + <span class="string">"']"</span>).attr(</span><br><span class="line">                    <span class="string">"selected"</span>, <span class="string">"selected"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 取得所有二级店铺类别以及区域信息，并分别赋值进类别列表以及区域列表</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getShopInitInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 发送一个异步请求，第一个参数访问地址，第二个参数回调函数</span></span><br><span class="line">        $.getJSON(initUrl, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// ↓访问成功</span></span><br><span class="line">            <span class="keyword">if</span> (data.success) &#123;</span><br><span class="line">                <span class="comment">// ↓初始化保存店铺分类的html文本</span></span><br><span class="line">                <span class="keyword">var</span> tempHtml = <span class="string">''</span>;</span><br><span class="line">                <span class="comment">// ↓初始化保存区域分类的html文本</span></span><br><span class="line">                <span class="keyword">var</span> tempAreaHtml = <span class="string">''</span>;</span><br><span class="line">                <span class="comment">// ↓赋值店铺分类html文本</span></span><br><span class="line">                <span class="comment">// ↓shopCategoryList是返回的data数据里面的一项，由后端负责</span></span><br><span class="line">                <span class="comment">// ↓以下是ES6语法，直接使用map方法将键值对的内容赋值给tempHtml</span></span><br><span class="line">                data.shopCategoryList.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">                    tempHtml += <span class="string">'&lt;option data-id="'</span> + item.shopCategoryId</span><br><span class="line">                        + <span class="string">'"&gt;'</span> + item.shopCategoryName + <span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// ↓同上</span></span><br><span class="line">                data.areaList.map(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">                    tempAreaHtml += <span class="string">'&lt;option data-id="'</span> + item.areaId + <span class="string">'"&gt;'</span></span><br><span class="line">                        + item.areaName + <span class="string">'&lt;/option&gt;'</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// ↓重写id为shop-category的DOM元素的html内容</span></span><br><span class="line">                $(<span class="string">'#shop-category'</span>).html(tempHtml);</span><br><span class="line">                <span class="comment">// ↓同上</span></span><br><span class="line">                $(<span class="string">'#area'</span>).html(tempAreaHtml);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提交按钮的事件响应，分别对店铺注册和编辑操作做不同响应</span></span><br><span class="line">    $(<span class="string">'#submit'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 创建shop对象</span></span><br><span class="line">        <span class="keyword">var</span> shop = &#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span> (isEdit) &#123;</span><br><span class="line">            <span class="comment">// 若属于编辑，则给shopId赋值</span></span><br><span class="line">            shop.shopId = shopId;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取表单里的数据并填充进对应的店铺属性中</span></span><br><span class="line">        shop.shopName = $(<span class="string">'#shop-name'</span>).val();</span><br><span class="line">        shop.shopAddr = $(<span class="string">'#shop-addr'</span>).val();</span><br><span class="line">        shop.phone = $(<span class="string">'#shop-phone'</span>).val();</span><br><span class="line">        shop.shopDesc = $(<span class="string">'#shop-desc'</span>).val();</span><br><span class="line">        <span class="comment">// 选择选定好的店铺类别</span></span><br><span class="line">        shop.shopCategory = &#123;</span><br><span class="line">            shopCategoryId: $(<span class="string">'#shop-category'</span>).find(<span class="string">'option'</span>).not(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="keyword">this</span>.selected;</span><br><span class="line">            &#125;).data(<span class="string">'id'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 选择选定好的区域信息</span></span><br><span class="line">        shop.area = &#123;</span><br><span class="line">            areaId: $(<span class="string">'#area'</span>).find(<span class="string">'option'</span>).not(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="keyword">this</span>.selected;</span><br><span class="line">            &#125;).data(<span class="string">'id'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 获取上传的图片文件流</span></span><br><span class="line">        <span class="keyword">var</span> shopImg = $(<span class="string">'#shop-img'</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 生成表单对象，用于接收参数并传递给后台</span></span><br><span class="line">        <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">        <span class="comment">// 添加图片流进表单对象里</span></span><br><span class="line">        formData.append(<span class="string">'shopImg'</span>, shopImg);</span><br><span class="line">        <span class="comment">// 将shop json对象转成字符流保存至表单对象key为shopStr的的键值对里</span></span><br><span class="line">        formData.append(<span class="string">'shopStr'</span>, <span class="built_in">JSON</span>.stringify(shop));</span><br><span class="line">        <span class="comment">// 获取表单里输入的验证码</span></span><br><span class="line">        <span class="keyword">var</span> verifyCodeActual = $(<span class="string">'#j_captcha'</span>).val();</span><br><span class="line">        <span class="keyword">if</span> (!verifyCodeActual) &#123;</span><br><span class="line">            $.toast(<span class="string">'请输入验证码！'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        formData.append(<span class="string">'verifyCodeActual'</span>, verifyCodeActual);</span><br><span class="line">        <span class="comment">// 将数据提交至后台处理相关操作</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url : (isEdit ? editShopUrl : registerShopUrl),</span><br><span class="line">            type : <span class="string">'POST'</span>,</span><br><span class="line">            data : formData,</span><br><span class="line">            contentType : <span class="literal">false</span>,</span><br><span class="line">            processData : <span class="literal">false</span>,</span><br><span class="line">            cache : <span class="literal">false</span>,</span><br><span class="line">            success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (data.success) &#123;</span><br><span class="line">                    $.toast(<span class="string">'提交成功！'</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $.toast(<span class="string">'提交失败！'</span> + data.errMsg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 点击验证码图片的时候，注册码会改变</span></span><br><span class="line">                $(<span class="string">'#captcha_img'</span>).click();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功<code>&lt;http://localhost:8080/shopadmin/shopoperation?shopId=43&gt;</code></p>
</blockquote>
<h2 id="9-13店铺列表展示"><a href="#9-13店铺列表展示" class="headerlink" title="9.13店铺列表展示"></a>9.13店铺列表展示</h2><h3 id="9-13-1修改Dao层"><a href="#9-13-1修改Dao层" class="headerlink" title="9.13.1修改Dao层"></a>9.13.1修改Dao层</h3><p><code>ShopDao</code>接口添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询店铺，可输入的条件有：店铺名(模糊),店铺状态，店铺类别，区域Id,owner</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shopCondition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rowIndex 从第几行开始取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize 返回的条数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">List&lt;Shop&gt; <span class="title">queryShopList</span><span class="params">(@Param(<span class="string">"shopCondition"</span>)</span> Shop shopCondition,</span></span><br><span class="line"><span class="function">                         @<span class="title">Param</span><span class="params">(<span class="string">"rowIndex"</span>)</span> <span class="keyword">int</span> rowIndex,</span></span><br><span class="line"><span class="function">                         @<span class="title">Param</span><span class="params">(<span class="string">"pageSize"</span>)</span> <span class="keyword">int</span> pageSize)</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回queryShopList总数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shopCondition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">queryShopCount</span><span class="params">(@Param(<span class="string">"shopCondition"</span>)</span> Shop shopCondition)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="9-13-2修改Mybatis文件"><a href="#9-13-2修改Mybatis文件" class="headerlink" title="9.13.2修改Mybatis文件"></a>9.13.2修改Mybatis文件</h3><p><code>ShopDao.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryShopList"</span> <span class="attr">resultMap</span>=<span class="string">"shopMap"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    s.shop_id,</span><br><span class="line">    s.shop_name,</span><br><span class="line">    s.shop_desc,</span><br><span class="line">    s.shop_addr,</span><br><span class="line">    s.phone,</span><br><span class="line">    s.shop_img,</span><br><span class="line">    s.priority,</span><br><span class="line">    s.create_time,</span><br><span class="line">    s.last_edit_time,</span><br><span class="line">    s.enable_status,</span><br><span class="line">    s.advice,</span><br><span class="line">    a.area_id,</span><br><span class="line">    a.area_name,</span><br><span class="line">    sc.shop_category_id,</span><br><span class="line">    sc.shop_category_name</span><br><span class="line">    FROM</span><br><span class="line">    tb_shop s,</span><br><span class="line">    tb_area a,</span><br><span class="line">    tb_shop_category sc</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.shopCategory != null and</span></span></span><br><span class="line"><span class="tag"><span class="string">                  shopCondition.shopCategory.shopCategoryId != null"</span>&gt;</span></span><br><span class="line">            and s.shop_category_id =</span><br><span class="line">            #&#123;shopCondition.shopCategory.shopCategoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.area != null and</span></span></span><br><span class="line"><span class="tag"><span class="string">                  shopCondition.area.areaId != null"</span>&gt;</span></span><br><span class="line">            and s.area_id =</span><br><span class="line">            #&#123;shopCondition.area.areaId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.shopName != null"</span>&gt;</span></span><br><span class="line">            and s.shop_name like '%$&#123;shopCondition.shopName&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.enableStatus != null"</span>&gt;</span></span><br><span class="line">            and s.enable_status = #&#123;shopCondition.enableStatus&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.owner != null and shopCondition.owner.userId != null"</span>&gt;</span></span><br><span class="line">            and s.owner_id = #&#123;shopCondition.owner.userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        AND</span><br><span class="line">        s.area_id=a.area_id</span><br><span class="line">        AND</span><br><span class="line">        s.shop_category_id = sc.shop_category_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    ORDER BY</span><br><span class="line">    s.priority DESC</span><br><span class="line">    LIMIT #&#123;rowIndex&#125;,#&#123;pageSize&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryShopCount"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    count(1)</span><br><span class="line">    FROM</span><br><span class="line">    tb_shop s,</span><br><span class="line">    tb_area a,</span><br><span class="line">    tb_shop_category sc</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.shopCategory != null and</span></span></span><br><span class="line"><span class="tag"><span class="string">                  shopCondition.shopCategory.shopCategoryId != null"</span>&gt;</span></span><br><span class="line">            and s.shop_category_id =</span><br><span class="line">            #&#123;shopCondition.shopCategory.shopCategoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.area != null and</span></span></span><br><span class="line"><span class="tag"><span class="string">                  shopCondition.area.areaId != null"</span>&gt;</span></span><br><span class="line">            and s.area_id =</span><br><span class="line">            #&#123;shopCondition.area.areaId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.shopName != null"</span>&gt;</span></span><br><span class="line">            and s.shop_name like '%$&#123;shopCondition.shopName&#125;%'</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.enableStatus != null"</span>&gt;</span></span><br><span class="line">            and s.enable_status = #&#123;shopCondition.enableStatus&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"shopCondition.owner != null and shopCondition.owner.userId != null"</span>&gt;</span></span><br><span class="line">            and s.owner_id = #&#123;shopCondition.owner.userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        AND</span><br><span class="line">        s.area_id=a.area_id</span><br><span class="line">        AND</span><br><span class="line">        s.shop_category_id = sc.shop_category_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Dao层测试</strong></p>
<p><code>ShopDaoTest</code>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryShopList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Shop shopCondition = <span class="keyword">new</span> Shop();</span><br><span class="line">    PersonInfo owner = <span class="keyword">new</span> PersonInfo();</span><br><span class="line">    owner.setUserId(<span class="number">1L</span>);</span><br><span class="line">    shopCondition.setOwner(owner);</span><br><span class="line">    List&lt;Shop&gt; shopList = shopDao.queryShopList(shopCondition, <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">int</span> count = shopDao.queryShopCount(shopCondition);</span><br><span class="line">    System.out.println(<span class="string">"店铺列表的大小："</span> + shopList.size());</span><br><span class="line">    System.out.println(<span class="string">"店铺总数："</span> + count);</span><br><span class="line">    ShopCategory sc = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">    sc.setShopCategoryId(<span class="number">36L</span>);</span><br><span class="line">    shopCondition.setShopCategory(sc);</span><br><span class="line">    shopList = shopDao.queryShopList(shopCondition, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    count = shopDao.queryShopCount(shopCondition);</span><br><span class="line">    System.out.println(<span class="string">"===店铺列表的大小："</span> + shopList.size());</span><br><span class="line">    System.out.println(<span class="string">"===店铺总数："</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<h3 id="9-13-3修改Service层"><a href="#9-13-3修改Service层" class="headerlink" title="9.13.3修改Service层"></a>9.13.3修改Service层</h3><p><code>ShopService</code>接口添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据shopCondition分页返回相应店铺列表</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> shopCondition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageIndex</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShopExecution <span class="title">getShopList</span><span class="params">(Shop shopCondition, <span class="keyword">int</span> pageIndex, <span class="keyword">int</span> pageSize)</span></span>;</span><br></pre></td></tr></table></figure>
<p>因为这里接收的是页面，但是在底层<code>Mybatis</code>接收的是行数，所以要添加一个工具类</p>
<p><strong>工具类</strong></p>
<p><code>PageCalculator</code>工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoxin.o2o.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCalculator</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateRowIndex</span><span class="params">(<span class="keyword">int</span> pageIndex, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (pageIndex &gt; <span class="number">0</span>) ? (pageIndex - <span class="number">1</span>) * pageSize : <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ShopServiceImpl</code>实现类添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShopExecution <span class="title">getShopList</span><span class="params">(Shop shopCondition, <span class="keyword">int</span> pageIndex, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将页码转换成行码</span></span><br><span class="line">    <span class="keyword">int</span> rowIndex = PageCalculator.calculateRowIndex(pageIndex, pageSize);</span><br><span class="line">    <span class="comment">//依据查询条件，调用dao层返回相关的店铺列表</span></span><br><span class="line">    List&lt;Shop&gt; shopList = shopDao.queryShopList(shopCondition, rowIndex, pageSize);</span><br><span class="line">    <span class="comment">//依据相同的查询条件，返回店铺总数</span></span><br><span class="line">    <span class="keyword">int</span> count = shopDao.queryShopCount(shopCondition);</span><br><span class="line">    ShopExecution se = <span class="keyword">new</span> ShopExecution();</span><br><span class="line">    <span class="keyword">if</span> (shopList != <span class="keyword">null</span>) &#123;</span><br><span class="line">        se.setShopList(shopList);</span><br><span class="line">        se.setCount(count);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        se.setState(ShopStateEnum.INNER_ERROR.getState());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> se;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试Service层</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetShopList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Shop shopCondition = <span class="keyword">new</span> Shop();</span><br><span class="line">    ShopCategory sc = <span class="keyword">new</span> ShopCategory();</span><br><span class="line">    sc.setShopCategoryId(<span class="number">36L</span>);</span><br><span class="line">    shopCondition.setShopCategory(sc);</span><br><span class="line">    ShopExecution se = shopService.getShopList(shopCondition, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">"店铺列表数为："</span> + se.getShopList().size());</span><br><span class="line">    System.out.println(<span class="string">"店铺总数为："</span> + se.getCount());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试成功</p>
</blockquote>
<h3 id="9-13-4修改Controller层"><a href="#9-13-4修改Controller层" class="headerlink" title="9.13.4修改Controller层"></a>9.13.4修改Controller层</h3><p><code>ShopManagementController</code>控制类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/getshoplist"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">getShopList</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; modelMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    PersonInfo user = (PersonInfo) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Shop shopCondition = <span class="keyword">new</span> Shop();</span><br><span class="line">        shopCondition.setOwner(user);</span><br><span class="line">        ShopExecution se = shopService.getShopList(shopCondition, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        modelMap.put(<span class="string">"shopList"</span>, se.getShopList());</span><br><span class="line">        <span class="comment">// 列出店铺成功之后，将店铺放入session中作为权限验证依据，即该帐号只能操作它自己的店铺</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">"shopList"</span>, se.getShopList());</span><br><span class="line">        modelMap.put(<span class="string">"user"</span>, user);</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        modelMap.put(<span class="string">"success"</span>, <span class="keyword">false</span>);</span><br><span class="line">        modelMap.put(<span class="string">"errMsg"</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> modelMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试<code>&lt;http://localhost:8080/shopadmin/getshoplist&gt;</code></p>
</blockquote>

      
    </div>

    

    
    
    


    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------This article is over-------------</div>
    
</div>

      
    </div>

    <div>
          
            
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2019/05/08/课程项目/">课程项目</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 Fidel Yiu 的个人博客">Fidel Yiu</a></p>
  <p><span>发布时间:</span>2019年05月08日 - 16:05</p>
  <p><span>最后更新:</span>2019年05月08日 - 21:05</p>
  <p><span>原始链接:</span><a href="/2019/05/08/课程项目/" title="课程项目">https://vxiaoxin.github.io/2019/05/08/课程项目/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://vxiaoxin.github.io/2019/05/08/课程项目/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>
</div>
<script>
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({
          title: "",
          text: '复制成功',
          icon: "success",
          showConfirmButton: true
          });
    });
    });
</script>


          
    </div>


    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/后端/" rel="tag"><i class="fa fa-tag"></i> 后端</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/04/致英子的情书5/" rel="next" title="致英子的情书5">
                <i class="fa fa-chevron-left"></i> 致英子的情书5
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/10/26/Windows搭建halo博客/" rel="prev" title="Windows搭建halo博客">
                Windows搭建halo博客 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/feidao-logo.jpg" alt="Fidel Yiu">
            
              <p class="site-author-name" itemprop="name">Fidel Yiu</p>
              <p class="site-description motion-element" itemprop="description">大悲大喜过后,我还曾渴望过什么呢?<br>看着夕阳傻笑,看着霓虹灯落寞.<br>可我还有梦想呀,你一定要加油.<br>一直努力!</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/VXiaoXin" title="GitHub &rarr; https://github.com/VXiaoXin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://gitee.com/" title="码云 &rarr; https://gitee.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>码云</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://blog.fangshuoit.com/" title="方硕公司博客 &rarr; http://blog.fangshuoit.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-graduation-cap"></i>方硕公司博客</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://gank.io/" title="干货小博客 &rarr; https://gank.io/" rel="noopener" target="_blank"><i class="fa fa-fw fa-graduation-cap"></i>干货小博客</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.xd0.com/" title="小刀资源 &rarr; https://www.xd0.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-flash"></i>小刀资源</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.kxdao.net/" title="科学刀 &rarr; https://www.kxdao.net/" rel="noopener" target="_blank"><i class="fa fa-fw fa-flash"></i>科学刀</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://cloud.tencent.com/developer/labs/gallery" title="云实验室 &rarr; https://cloud.tencent.com/developer/labs/gallery" rel="noopener" target="_blank"><i class="fa fa-fw fa-flash"></i>云实验室</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.sojson.com/ip/" title="IP查询 &rarr; https://www.sojson.com/ip/" rel="noopener" target="_blank"><i class="fa fa-fw fa-flash"></i>IP查询</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.baidu.com/" title="百度 &rarr; https://www.baidu.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-paw"></i>百度</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://fanyi.baidu.com/?aldtype=16047#auto/zh" title="百度翻译 &rarr; https://fanyi.baidu.com/?aldtype=16047#auto/zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-language"></i>百度翻译</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.processon.com/" title="Process On &rarr; https://www.processon.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-object-ungroup"></i>Process On</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://msdn.itellyou.cn/" title="系统下载 &rarr; https://msdn.itellyou.cn/" rel="noopener" target="_blank"><i class="fa fa-fw fa-file-archive-o"></i>系统下载</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.bilibili.com/" title="B站 &rarr; https://www.bilibili.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-bold"></i>B站</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.heimidy.cc/index.html" title="黑米影院 &rarr; https://www.heimidy.cc/index.html" rel="noopener" target="_blank"><i class="fa fa-fw fa-video-camera"></i>黑米影院</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://doc.vue-js.com/" title="Vue &rarr; http://doc.vue-js.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>Vue</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://youzan.github.io/vant/#/zh-CN/intro" title="Vant &rarr; https://youzan.github.io/vant/#/zh-CN/intro" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>Vant</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.iviewui.com/" title="iview &rarr; https://www.iviewui.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>iview</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://admin.iviewui.com/login" title="iview-admin &rarr; https://admin.iviewui.com/login" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>iview-admin</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.iconfont.cn/" title="阿里矢量图库 &rarr; https://www.iconfont.cn/" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>阿里矢量图库</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://fontawesome.dashgame.com/" title="Font Awesome &rarr; http://fontawesome.dashgame.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>Font Awesome</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://so.uigreat.com/" title="UI设计师导航 &rarr; http://so.uigreat.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>UI设计师导航</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://dribbble.com/" title="Dribbble &rarr; https://dribbble.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-underline"></i>Dribbble</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://streetwill.co/" title="Streetwill &rarr; http://streetwill.co/" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>Streetwill</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://wall.alphacoders.com/?lang=Chinese" title="WALLPAPER ABYSS &rarr; https://wall.alphacoders.com/?lang=Chinese" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>WALLPAPER ABYSS</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://alpha.wallhaven.cc/" title="Wallhaven &rarr; https://alpha.wallhaven.cc/" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>Wallhaven</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://unsplash.com/" title="Unsplash &rarr; https://unsplash.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>Unsplash</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.pexels.com/" title="Pexels &rarr; https://www.pexels.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>Pexels</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://weavesilk.com/" title="WeaveSilk &rarr; http://weavesilk.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>WeaveSilk</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.ssyer.com/home" title="沙沙兔 &rarr; https://www.ssyer.com/home" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>沙沙兔</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://www.bigbigwork.com/" title="大作 &rarr; http://www.bigbigwork.com/" rel="noopener" target="_blank"><i class="fa fa-fw fa-picture-o"></i>大作</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-新建项目"><span class="nav-number">1.</span> <span class="nav-text">1.新建项目</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1配置JDK"><span class="nav-number">1.1.</span> <span class="nav-text">1.1配置JDK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2添加Tomcat"><span class="nav-number">1.2.</span> <span class="nav-text">1.2添加Tomcat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3修改渲染模板"><span class="nav-number">1.3.</span> <span class="nav-text">1.3修改渲染模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4配置默认启动路径"><span class="nav-number">1.4.</span> <span class="nav-text">1.4配置默认启动路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5运行项目"><span class="nav-number">1.5.</span> <span class="nav-text">1.5运行项目</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-实体类设计"><span class="nav-number">2.</span> <span class="nav-text">2.实体类设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1区域实体类"><span class="nav-number">2.1.</span> <span class="nav-text">2.1区域实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1实体类"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.1.1实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2数据库"><span class="nav-number">2.1.2.</span> <span class="nav-text">2.1.2数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2用户实体类"><span class="nav-number">2.2.</span> <span class="nav-text">2.2用户实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1实体类"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.2.1实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2数据库"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2.2数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3微信-amp-本地账号"><span class="nav-number">2.3.</span> <span class="nav-text">2.3微信&amp;本地账号</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1微信实体类"><span class="nav-number">2.3.1.</span> <span class="nav-text">2.3.1微信实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2本地账号实体类"><span class="nav-number">2.3.2.</span> <span class="nav-text">2.3.2本地账号实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-3微信号数据库"><span class="nav-number">2.3.3.</span> <span class="nav-text">2.3.3微信号数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-4本地号数据库"><span class="nav-number">2.3.4.</span> <span class="nav-text">2.3.4本地号数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4头条实体类"><span class="nav-number">2.4.</span> <span class="nav-text">2.4头条实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1头条实体类"><span class="nav-number">2.4.1.</span> <span class="nav-text">2.4.1头条实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2头条数据库"><span class="nav-number">2.4.2.</span> <span class="nav-text">2.4.2头条数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5店铺类别实体类"><span class="nav-number">2.5.</span> <span class="nav-text">2.5店铺类别实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-1店铺实体类"><span class="nav-number">2.5.1.</span> <span class="nav-text">2.5.1店铺实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-2店铺类别数据库"><span class="nav-number">2.5.2.</span> <span class="nav-text">2.5.2店铺类别数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6店铺实体类"><span class="nav-number">2.6.</span> <span class="nav-text">2.6店铺实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-1店铺实体类"><span class="nav-number">2.6.1.</span> <span class="nav-text">2.6.1店铺实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-2店铺数据库"><span class="nav-number">2.6.2.</span> <span class="nav-text">2.6.2店铺数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7商品类别实体类"><span class="nav-number">2.7.</span> <span class="nav-text">2.7商品类别实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-1实体类"><span class="nav-number">2.7.1.</span> <span class="nav-text">2.7.1实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-2数据库"><span class="nav-number">2.7.2.</span> <span class="nav-text">2.7.2数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-8商品实体类"><span class="nav-number">2.8.</span> <span class="nav-text">2.8商品实体类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-1实体类"><span class="nav-number">2.8.1.</span> <span class="nav-text">2.8.1实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-2数据库"><span class="nav-number">2.8.2.</span> <span class="nav-text">2.8.2数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-9详情图片"><span class="nav-number">2.9.</span> <span class="nav-text">2.9详情图片</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-1实体类"><span class="nav-number">2.9.1.</span> <span class="nav-text">2.9.1实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-2数据库"><span class="nav-number">2.9.2.</span> <span class="nav-text">2.9.2数据库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-配置Maven"><span class="nav-number">3.</span> <span class="nav-text">3.配置Maven</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1文件概述"><span class="nav-number">3.1.</span> <span class="nav-text">3.1文件概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2引入文件jar包"><span class="nav-number">3.2.</span> <span class="nav-text">3.2引入文件jar包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-项目配置文件"><span class="nav-number">4.</span> <span class="nav-text">4.项目配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1数据库配置"><span class="nav-number">4.1.</span> <span class="nav-text">4.1数据库配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2Mybatis配置"><span class="nav-number">4.2.</span> <span class="nav-text">4.2Mybatis配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3Spring配置文件"><span class="nav-number">4.3.</span> <span class="nav-text">4.3Spring配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1Spring-dao"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.3.1Spring-dao</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2Spring-service"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.3.2Spring-service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3Spring-web"><span class="nav-number">4.3.3.</span> <span class="nav-text">4.3.3Spring-web</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4修改web-xml"><span class="nav-number">4.3.4.</span> <span class="nav-text">4.3.4修改web.xml</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-验证Dao层"><span class="nav-number">5.</span> <span class="nav-text">5.验证Dao层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1添加AreaDao接口"><span class="nav-number">5.1.</span> <span class="nav-text">5.1添加AreaDao接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2添加AreaDao-xml"><span class="nav-number">5.2.</span> <span class="nav-text">5.2添加AreaDao.xml</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3添加测试类"><span class="nav-number">5.3.</span> <span class="nav-text">5.3添加测试类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1创建BaseTest"><span class="nav-number">5.3.1.</span> <span class="nav-text">5.3.1创建BaseTest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2创建AreaDaoTest"><span class="nav-number">5.3.2.</span> <span class="nav-text">5.3.2创建AreaDaoTest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3创建测试数据"><span class="nav-number">5.3.3.</span> <span class="nav-text">5.3.3创建测试数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-4报错处理"><span class="nav-number">5.3.4.</span> <span class="nav-text">5.3.4报错处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-验证service层"><span class="nav-number">6.</span> <span class="nav-text">6.验证service层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1AreaService"><span class="nav-number">6.1.</span> <span class="nav-text">6.1AreaService</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1接口"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.1.1接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2实现类"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.1.2实现类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2测试"><span class="nav-number">6.2.</span> <span class="nav-text">6.2测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1修改BaseTest"><span class="nav-number">6.2.1.</span> <span class="nav-text">6.2.1修改BaseTest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2创建测试代码"><span class="nav-number">6.2.2.</span> <span class="nav-text">6.2.2创建测试代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-验证Controller层"><span class="nav-number">7.</span> <span class="nav-text">7.验证Controller层</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1创建AreaController"><span class="nav-number">7.1.</span> <span class="nav-text">7.1创建AreaController</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2验证"><span class="nav-number">7.2.</span> <span class="nav-text">7.2验证</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-日志管理"><span class="nav-number">8.</span> <span class="nav-text">8.日志管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1Logback的主要模块"><span class="nav-number">8.1.</span> <span class="nav-text">8.1Logback的主要模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2Logback主要标签"><span class="nav-number">8.2.</span> <span class="nav-text">8.2Logback主要标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3配置logback"><span class="nav-number">8.3.</span> <span class="nav-text">8.3配置logback</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-1创建logback-xml"><span class="nav-number">8.3.1.</span> <span class="nav-text">8.3.1创建logback.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-2验证配置"><span class="nav-number">8.3.2.</span> <span class="nav-text">8.3.2验证配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-店铺管理系统"><span class="nav-number">9.</span> <span class="nav-text">9.店铺管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1店铺创建"><span class="nav-number">9.1.</span> <span class="nav-text">9.1店铺创建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-1创建ShopDao"><span class="nav-number">9.1.1.</span> <span class="nav-text">9.1.1创建ShopDao</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-2创建ShopDao-xml"><span class="nav-number">9.1.2.</span> <span class="nav-text">9.1.2创建ShopDao.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-3测试类"><span class="nav-number">9.1.3.</span> <span class="nav-text">9.1.3测试类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2店铺修改"><span class="nav-number">9.2.</span> <span class="nav-text">9.2店铺修改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-1修改ShopDao"><span class="nav-number">9.2.1.</span> <span class="nav-text">9.2.1修改ShopDao</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-2修改ShopDao-xml"><span class="nav-number">9.2.2.</span> <span class="nav-text">9.2.2修改ShopDao.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-3测试类"><span class="nav-number">9.2.3.</span> <span class="nav-text">9.2.3测试类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3水印处理"><span class="nav-number">9.3.</span> <span class="nav-text">9.3水印处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-1添加依赖"><span class="nav-number">9.3.1.</span> <span class="nav-text">9.3.1添加依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-2图片准备"><span class="nav-number">9.3.2.</span> <span class="nav-text">9.3.2图片准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-3图片工具类"><span class="nav-number">9.3.3.</span> <span class="nav-text">9.3.3图片工具类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4路径工具类"><span class="nav-number">9.4.</span> <span class="nav-text">9.4路径工具类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5图片缩略处理"><span class="nav-number">9.5.</span> <span class="nav-text">9.5图片缩略处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6店铺注册Dto层"><span class="nav-number">9.6.</span> <span class="nav-text">9.6店铺注册Dto层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7店铺注册Service层"><span class="nav-number">9.7.</span> <span class="nav-text">9.7店铺注册Service层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-1创建ShopService"><span class="nav-number">9.7.1.</span> <span class="nav-text">9.7.1创建ShopService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-2扩展RuntimeException"><span class="nav-number">9.7.2.</span> <span class="nav-text">9.7.2扩展RuntimeException</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-7-3测试"><span class="nav-number">9.7.3.</span> <span class="nav-text">9.7.3测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-8店铺注册Controller层"><span class="nav-number">9.8.</span> <span class="nav-text">9.8店铺注册Controller层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-8-1HTTP请求工具类"><span class="nav-number">9.8.1.</span> <span class="nav-text">9.8.1HTTP请求工具类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-8-2JSON转换"><span class="nav-number">9.8.2.</span> <span class="nav-text">9.8.2JSON转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-8-3创建控制类"><span class="nav-number">9.8.3.</span> <span class="nav-text">9.8.3创建控制类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-9店铺注册优化"><span class="nav-number">9.9.</span> <span class="nav-text">9.9店铺注册优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-1修改ShopService接口"><span class="nav-number">9.9.1.</span> <span class="nav-text">9.9.1修改ShopService接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-2修改实现类"><span class="nav-number">9.9.2.</span> <span class="nav-text">9.9.2修改实现类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-3修改工具类"><span class="nav-number">9.9.3.</span> <span class="nav-text">9.9.3修改工具类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-4修改Shop控制类"><span class="nav-number">9.9.4.</span> <span class="nav-text">9.9.4修改Shop控制类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-9-5修改测试代码"><span class="nav-number">9.9.5.</span> <span class="nav-text">9.9.5修改测试代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-10店铺注册前端实现"><span class="nav-number">9.10.</span> <span class="nav-text">9.10店铺注册前端实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-1创建index页面"><span class="nav-number">9.10.1.</span> <span class="nav-text">9.10.1创建index页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-2引用静态资源"><span class="nav-number">9.10.2.</span> <span class="nav-text">9.10.2引用静态资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-3修改代码"><span class="nav-number">9.10.3.</span> <span class="nav-text">9.10.3修改代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-4静态资源调整"><span class="nav-number">9.10.4.</span> <span class="nav-text">9.10.4静态资源调整</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-5后端路由导向"><span class="nav-number">9.10.5.</span> <span class="nav-text">9.10.5后端路由导向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-6创建JS文件"><span class="nav-number">9.10.6.</span> <span class="nav-text">9.10.6创建JS文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-7后端响应JS方法"><span class="nav-number">9.10.7.</span> <span class="nav-text">9.10.7后端响应JS方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-10-8修改店铺类别Mybatis"><span class="nav-number">9.10.8.</span> <span class="nav-text">9.10.8修改店铺类别Mybatis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-11添加验证码"><span class="nav-number">9.11.</span> <span class="nav-text">9.11添加验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-1web-xml配置"><span class="nav-number">9.11.1.</span> <span class="nav-text">9.11.1web.xml配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-2修改shopoperation-html"><span class="nav-number">9.11.2.</span> <span class="nav-text">9.11.2修改shopoperation.html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-3添加js"><span class="nav-number">9.11.3.</span> <span class="nav-text">9.11.3添加js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-4修改提交js"><span class="nav-number">9.11.4.</span> <span class="nav-text">9.11.4修改提交js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-5页面引入JS"><span class="nav-number">9.11.5.</span> <span class="nav-text">9.11.5页面引入JS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-6响应验证码后端"><span class="nav-number">9.11.6.</span> <span class="nav-text">9.11.6响应验证码后端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-11-7DeBug测试"><span class="nav-number">9.11.7.</span> <span class="nav-text">9.11.7DeBug测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-12店铺信息修改"><span class="nav-number">9.12.</span> <span class="nav-text">9.12店铺信息修改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-12-1店铺信息获取"><span class="nav-number">9.12.1.</span> <span class="nav-text">9.12.1店铺信息获取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-12-2前端实现"><span class="nav-number">9.12.2.</span> <span class="nav-text">9.12.2前端实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-13店铺列表展示"><span class="nav-number">9.13.</span> <span class="nav-text">9.13店铺列表展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-13-1修改Dao层"><span class="nav-number">9.13.1.</span> <span class="nav-text">9.13.1修改Dao层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-13-2修改Mybatis文件"><span class="nav-number">9.13.2.</span> <span class="nav-text">9.13.2修改Mybatis文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-13-3修改Service层"><span class="nav-number">9.13.3.</span> <span class="nav-text">9.13.3修改Service层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-13-4修改Controller层"><span class="nav-number">9.13.4.</span> <span class="nav-text">9.13.4修改Controller层</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>

  <span class="post-meta-divider">|</span>
  <span class="with-love" id="animate">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fidel Yiu</span>

  <span class="post-meta-divider">|</span>
  <div class="theme-info">
    <div class="powered-by"></div>
    <span class="post-count">博客全站共67.6k字</span>
  </div>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      你是第<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>位访客
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      本站总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次
    </span>
  
</div>





  <script>
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=66179865";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'cpXAhhUV7pHMnxNo6HWTcDYP-gzGzoHsz',
    appKey: 'xPdyQq7iGeJDUKMSYw9NJEzN',
    placeholder: '评论不常管理,可以发表发表你的看法',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
